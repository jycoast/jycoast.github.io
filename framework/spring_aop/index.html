<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.66">
    <style>
      :root {
        --c-bg: #fff;
      }
      html.dark {
        --c-bg: #22272e;
      }
      html, body {
        background-color: var(--c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme');
			const systemDarkMode = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
			if (userMode === 'dark' || (userMode !== 'light' && systemDarkMode)) {
				document.documentElement.classList.toggle('dark', true);
			}
    </script>
    <link rel="icon" href="/favicon.ico"><link rel="manifest" href="/manifest.json"><title>Spring AOP | thinking in programming</title><meta name="description" content="">
    <link rel="preload" href="/assets/style-49d22bad.css" as="style"><link rel="stylesheet" href="/assets/style-49d22bad.css">
    <link rel="modulepreload" href="/assets/app-54c7c23e.js"><link rel="modulepreload" href="/assets/index.html-f90d3432.js"><link rel="modulepreload" href="/assets/index.html-767a9673.js"><link rel="prefetch" href="/assets/index.html-3a897c78.js" as="script"><link rel="prefetch" href="/assets/index.html-476fc76c.js" as="script"><link rel="prefetch" href="/assets/index.html-d2899db4.js" as="script"><link rel="prefetch" href="/assets/index.html-842f332a.js" as="script"><link rel="prefetch" href="/assets/index.html-f1f4b891.js" as="script"><link rel="prefetch" href="/assets/algorithm.html-29b924b3.js" as="script"><link rel="prefetch" href="/assets/data_structure.html-6b1e3c6f.js" as="script"><link rel="prefetch" href="/assets/index.html-ad271e99.js" as="script"><link rel="prefetch" href="/assets/index.html-5f57e3e8.js" as="script"><link rel="prefetch" href="/assets/index.html-3b8d2c8f.js" as="script"><link rel="prefetch" href="/assets/index.html-821a7213.js" as="script"><link rel="prefetch" href="/assets/index.html-6f206e7c.js" as="script"><link rel="prefetch" href="/assets/index.html-d1c0ca49.js" as="script"><link rel="prefetch" href="/assets/index.html-e7543ba7.js" as="script"><link rel="prefetch" href="/assets/cyber_security.html-f49379e5.js" as="script"><link rel="prefetch" href="/assets/Mybatis.html-c1dbdf7b.js" as="script"><link rel="prefetch" href="/assets/Netty.html-180ccfb8.js" as="script"><link rel="prefetch" href="/assets/Spring.html-4787372e.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-968aad66.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch.html-daa450e3.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-1163fbc9.js" as="script"><link rel="prefetch" href="/assets/Redis.html-ad8c90e0.js" as="script"><link rel="prefetch" href="/assets/microservice.html-b4b65216.js" as="script"><link rel="prefetch" href="/assets/mq.html-a90c5e13.js" as="script"><link rel="prefetch" href="/assets/Java_basics.html-feb5712f.js" as="script"><link rel="prefetch" href="/assets/Java_collections.html-3c4adbf8.js" as="script"><link rel="prefetch" href="/assets/Java_concurrency.html-e5319652.js" as="script"><link rel="prefetch" href="/assets/Java_network.html-bdfeae74.js" as="script"><link rel="prefetch" href="/assets/Java_virtual_machine.html-7789588e.js" as="script"><link rel="prefetch" href="/assets/index.html-7923c97b.js" as="script"><link rel="prefetch" href="/assets/index.html-c84466bc.js" as="script"><link rel="prefetch" href="/assets/index.html-2cda83d8.js" as="script"><link rel="prefetch" href="/assets/index.html-b9acafb1.js" as="script"><link rel="prefetch" href="/assets/index.html-afc3ba79.js" as="script"><link rel="prefetch" href="/assets/index.html-c63a085b.js" as="script"><link rel="prefetch" href="/assets/index.html-662a660e.js" as="script"><link rel="prefetch" href="/assets/index.html-78f8a5d7.js" as="script"><link rel="prefetch" href="/assets/index.html-96f4d640.js" as="script"><link rel="prefetch" href="/assets/404.html-f9875e7b.js" as="script"><link rel="prefetch" href="/assets/index.html-ce777d48.js" as="script"><link rel="prefetch" href="/assets/index.html-11176f36.js" as="script"><link rel="prefetch" href="/assets/index.html-7de90b9b.js" as="script"><link rel="prefetch" href="/assets/index.html-6ea57274.js" as="script"><link rel="prefetch" href="/assets/index.html-35f42870.js" as="script"><link rel="prefetch" href="/assets/algorithm.html-04d37bcb.js" as="script"><link rel="prefetch" href="/assets/data_structure.html-524c792e.js" as="script"><link rel="prefetch" href="/assets/index.html-bfc12a5b.js" as="script"><link rel="prefetch" href="/assets/index.html-051ac308.js" as="script"><link rel="prefetch" href="/assets/index.html-f65abe3c.js" as="script"><link rel="prefetch" href="/assets/index.html-a8ab1b29.js" as="script"><link rel="prefetch" href="/assets/index.html-1993ceda.js" as="script"><link rel="prefetch" href="/assets/index.html-68d55582.js" as="script"><link rel="prefetch" href="/assets/index.html-ccf8e57c.js" as="script"><link rel="prefetch" href="/assets/cyber_security.html-33027b0f.js" as="script"><link rel="prefetch" href="/assets/Mybatis.html-3395e17e.js" as="script"><link rel="prefetch" href="/assets/Netty.html-375d8afa.js" as="script"><link rel="prefetch" href="/assets/Spring.html-b38531d6.js" as="script"><link rel="prefetch" href="/assets/SpringBoot.html-83dd9589.js" as="script"><link rel="prefetch" href="/assets/Elasticsearch.html-4429834c.js" as="script"><link rel="prefetch" href="/assets/MySQL.html-b50de7c7.js" as="script"><link rel="prefetch" href="/assets/Redis.html-69133d36.js" as="script"><link rel="prefetch" href="/assets/microservice.html-83b6eaa3.js" as="script"><link rel="prefetch" href="/assets/mq.html-d4d1d51c.js" as="script"><link rel="prefetch" href="/assets/Java_basics.html-e8f8021f.js" as="script"><link rel="prefetch" href="/assets/Java_collections.html-706f21c5.js" as="script"><link rel="prefetch" href="/assets/Java_concurrency.html-37b9ad3a.js" as="script"><link rel="prefetch" href="/assets/Java_network.html-b324efb8.js" as="script"><link rel="prefetch" href="/assets/Java_virtual_machine.html-3fe9fe9a.js" as="script"><link rel="prefetch" href="/assets/index.html-a349621d.js" as="script"><link rel="prefetch" href="/assets/index.html-53621c5e.js" as="script"><link rel="prefetch" href="/assets/index.html-cc01d955.js" as="script"><link rel="prefetch" href="/assets/index.html-45bb700c.js" as="script"><link rel="prefetch" href="/assets/index.html-d09d49aa.js" as="script"><link rel="prefetch" href="/assets/index.html-3b5cfb50.js" as="script"><link rel="prefetch" href="/assets/index.html-7d9bd2c5.js" as="script"><link rel="prefetch" href="/assets/index.html-647f28ac.js" as="script"><link rel="prefetch" href="/assets/index.html-49827e9d.js" as="script"><link rel="prefetch" href="/assets/404.html-2c9f9c55.js" as="script"><link rel="prefetch" href="/assets/index-e32a7948.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="theme-container"><!--[--><header class="navbar"><div class="toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a href="/" class=""><img class="logo" src="/mlogo.svg" alt="thinking in programming"><span class="site-name can-hide">thinking in programming</span></a></span><div class="navbar-items-wrapper" style=""><!--[--><!--]--><nav class="navbar-items can-hide"><!--[--><div class="navbar-item"><a href="/interview/" class="" aria-label="Java 面试"><!--[--><!--]--> Java 面试 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java 基础"><span class="title">Java 基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java 基础"><span class="title">Java 基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/java_basics/functional_programming/" class="" aria-label="函数式编程"><!--[--><!--]--> 函数式编程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java_basics/core_technology/" class="" aria-label="Java核心技术原理"><!--[--><!--]--> Java核心技术原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java_basics/knowledge_system/" class="" aria-label="Java知识体系合辑"><!--[--><!--]--> Java知识体系合辑 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据结构与算法"><span class="title">数据结构与算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据结构与算法"><span class="title">数据结构与算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/leetcode/data_structure.md" class="" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/leetcode/algorithm.md" class="" aria-label="算法实战"><!--[--><!--]--> 算法实战 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>关系型数据库</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/database/mysql/" class="" aria-label="深入浅出MySQL"><!--[--><!--]--> 深入浅出MySQL <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>NoSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/database/redis/" class="" aria-label="深入浅出Redis"><!--[--><!--]--> 深入浅出Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="常用框架"><span class="title">常用框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="常用框架"><span class="title">常用框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Spring</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/framework/spring_framework/" class="" aria-label="Spring Framework"><!--[--><!--]--> Spring Framework <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/framework/spring_aop/" class="router-link-active router-link-exact-active router-link-active" aria-label="Spring AOP"><!--[--><!--]--> Spring AOP <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/framework/spring_boot/" class="" aria-label="Spring Boot"><!--[--><!--]--> Spring Boot <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/framework/spring_cloud/" class="" aria-label="Spring Cloud"><!--[--><!--]--> Spring Cloud <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>网络通信</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/framework/netty/" class="" aria-label="深入理解Netty"><!--[--><!--]--> 深入理解Netty <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="中间件"><span class="title">中间件</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="中间件"><span class="title">中间件</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/middleware/jvm/" class="" aria-label="深入理解JVM"><!--[--><!--]--> 深入理解JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/mq/" class="" aria-label="RocketMQ从实践到原理"><!--[--><!--]--> RocketMQ从实践到原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/tomcat/" class="" aria-label="Tomcat核心原理"><!--[--><!--]--> Tomcat核心原理 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="计算机原理"><span class="title">计算机原理</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="计算机原理"><span class="title">计算机原理</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/computer_theory/Os/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习指南"><span class="title">学习指南</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习指南"><span class="title">学习指南</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/study_guide/favorite_article/" class="" aria-label="深度好文"><!--[--><!--]--> 深度好文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/study_guide/study_materials/" class="" aria-label="资料大全"><!--[--><!--]--> 资料大全 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/study_guide/study_path/" class="" aria-label="学习路线"><!--[--><!--]--> 学习路线 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/about/" class="" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jycoast" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button class="toggle-color-mode-button" title="toggle color mode"><svg style="" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg style="display:none;" class="icon" focusable="false" viewBox="0 0 32 32"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="sidebar-mask"></div><!--[--><aside class="sidebar"><nav class="navbar-items"><!--[--><div class="navbar-item"><a href="/interview/" class="" aria-label="Java 面试"><!--[--><!--]--> Java 面试 <!--[--><!--]--></a></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="Java 基础"><span class="title">Java 基础</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="Java 基础"><span class="title">Java 基础</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/java_basics/functional_programming/" class="" aria-label="函数式编程"><!--[--><!--]--> 函数式编程 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java_basics/core_technology/" class="" aria-label="Java核心技术原理"><!--[--><!--]--> Java核心技术原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/java_basics/knowledge_system/" class="" aria-label="Java知识体系合辑"><!--[--><!--]--> Java知识体系合辑 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据结构与算法"><span class="title">数据结构与算法</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据结构与算法"><span class="title">数据结构与算法</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/leetcode/data_structure.md" class="" aria-label="数据结构"><!--[--><!--]--> 数据结构 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/leetcode/algorithm.md" class="" aria-label="算法实战"><!--[--><!--]--> 算法实战 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="数据库"><span class="title">数据库</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="数据库"><span class="title">数据库</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>关系型数据库</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/database/mysql/" class="" aria-label="深入浅出MySQL"><!--[--><!--]--> 深入浅出MySQL <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>NoSQL</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/database/redis/" class="" aria-label="深入浅出Redis"><!--[--><!--]--> 深入浅出Redis <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="常用框架"><span class="title">常用框架</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="常用框架"><span class="title">常用框架</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>Spring</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/framework/spring_framework/" class="" aria-label="Spring Framework"><!--[--><!--]--> Spring Framework <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a aria-current="page" href="/framework/spring_aop/" class="router-link-active router-link-exact-active router-link-active" aria-label="Spring AOP"><!--[--><!--]--> Spring AOP <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/framework/spring_boot/" class="" aria-label="Spring Boot"><!--[--><!--]--> Spring Boot <!--[--><!--]--></a></li><li class="navbar-dropdown-subitem"><a href="/framework/spring_cloud/" class="" aria-label="Spring Cloud"><!--[--><!--]--> Spring Cloud <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><li class="navbar-dropdown-item"><!--[--><h4 class="navbar-dropdown-subtitle"><span>网络通信</span></h4><ul class="navbar-dropdown-subitem-wrapper"><!--[--><li class="navbar-dropdown-subitem"><a href="/framework/netty/" class="" aria-label="深入理解Netty"><!--[--><!--]--> 深入理解Netty <!--[--><!--]--></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="中间件"><span class="title">中间件</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="中间件"><span class="title">中间件</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/middleware/jvm/" class="" aria-label="深入理解JVM"><!--[--><!--]--> 深入理解JVM <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/mq/" class="" aria-label="RocketMQ从实践到原理"><!--[--><!--]--> RocketMQ从实践到原理 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/middleware/tomcat/" class="" aria-label="Tomcat核心原理"><!--[--><!--]--> Tomcat核心原理 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="计算机原理"><span class="title">计算机原理</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="计算机原理"><span class="title">计算机原理</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/computer_theory/Os/" class="" aria-label="操作系统"><!--[--><!--]--> 操作系统 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><div class="navbar-dropdown-wrapper"><button class="navbar-dropdown-title" type="button" aria-label="学习指南"><span class="title">学习指南</span><span class="arrow down"></span></button><button class="navbar-dropdown-title-mobile" type="button" aria-label="学习指南"><span class="title">学习指南</span><span class="right arrow"></span></button><ul style="display:none;" class="navbar-dropdown"><!--[--><li class="navbar-dropdown-item"><a href="/study_guide/favorite_article/" class="" aria-label="深度好文"><!--[--><!--]--> 深度好文 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/study_guide/study_materials/" class="" aria-label="资料大全"><!--[--><!--]--> 资料大全 <!--[--><!--]--></a></li><li class="navbar-dropdown-item"><a href="/study_guide/study_path/" class="" aria-label="学习路线"><!--[--><!--]--> 学习路线 <!--[--><!--]--></a></li><!--]--></ul></div></div><div class="navbar-item"><a href="/about/" class="" aria-label="关于我"><!--[--><!--]--> 关于我 <!--[--><!--]--></a></div><div class="navbar-item"><a class="external-link" href="https://github.com/jycoast" rel="noopener noreferrer" target="_blank" aria-label="GitHub"><!--[--><!--]--> GitHub <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="sidebar-items"><!--[--><li><p tabindex="0" class="sidebar-item sidebar-heading">Spring AOP <!----></p><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#知识储备" class="router-link-active router-link-exact-active sidebar-item" aria-label="知识储备"><!--[--><!--]--> 知识储备 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#java-基础部分" class="router-link-active router-link-exact-active sidebar-item" aria-label="Java 基础部分"><!--[--><!--]--> Java 基础部分 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#oop-部分" class="router-link-active router-link-exact-active sidebar-item" aria-label="OOP 部分"><!--[--><!--]--> OOP 部分 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#gof23-设计模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="GOF23 设计模式"><!--[--><!--]--> GOF23 设计模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring-核心基础" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring 核心基础"><!--[--><!--]--> Spring 核心基础 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#oop局限性" class="router-link-active router-link-exact-active sidebar-item" aria-label="OOP局限性"><!--[--><!--]--> OOP局限性 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#aop常见使用场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="AOP常见使用场景"><!--[--><!--]--> AOP常见使用场景 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#日志场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="日志场景"><!--[--><!--]--> 日志场景 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#统计场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="统计场景"><!--[--><!--]--> 统计场景 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#安防场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="安防场景"><!--[--><!--]--> 安防场景 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#性能场景" class="router-link-active router-link-exact-active sidebar-item" aria-label="性能场景"><!--[--><!--]--> 性能场景 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#java-aop设计模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="Java AOP设计模式"><!--[--><!--]--> Java AOP设计模式 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#代理模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="代理模式"><!--[--><!--]--> 代理模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#判断模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="判断模式"><!--[--><!--]--> 判断模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#拦截模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="拦截模式"><!--[--><!--]--> 拦截模式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#spring-aop-功能概述" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP 功能概述"><!--[--><!--]--> Spring AOP 功能概述 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#aop设计核心" class="router-link-active router-link-exact-active sidebar-item" aria-label="AOP设计核心"><!--[--><!--]--> AOP设计核心 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring-aop编程模型" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP编程模型"><!--[--><!--]--> Spring AOP编程模型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring-aop-advice类型" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP Advice类型"><!--[--><!--]--> Spring AOP Advice类型 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring-aop代理实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP代理实现"><!--[--><!--]--> Spring AOP代理实现 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#面试题" class="router-link-active router-link-exact-active sidebar-item" aria-label="面试题"><!--[--><!--]--> 面试题 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#spring-aop和aspectj-aop存在哪些差别" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP和AspectJ AOP存在哪些差别？"><!--[--><!--]--> Spring AOP和AspectJ AOP存在哪些差别？ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#aspectj注解驱动" class="router-link-active router-link-exact-active sidebar-item" aria-label="@AspectJ注解驱动"><!--[--><!--]--> @AspectJ注解驱动 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#编程方式创建-aspectj代理" class="router-link-active router-link-exact-active sidebar-item" aria-label="编程方式创建@AspectJ代理"><!--[--><!--]--> 编程方式创建@AspectJ代理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#标准工厂api" class="router-link-active router-link-exact-active sidebar-item" aria-label="标准工厂API"><!--[--><!--]--> 标准工厂API <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aspectj-pointcut指令与表达式" class="router-link-active router-link-exact-active sidebar-item" aria-label="@AspectJ Pointcut指令与表达式"><!--[--><!--]--> @AspectJ Pointcut指令与表达式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#xml配置pointcut" class="router-link-active router-link-exact-active sidebar-item" aria-label="XML配置Pointcut"><!--[--><!--]--> XML配置Pointcut <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#api实现pointcut" class="router-link-active router-link-exact-active sidebar-item" aria-label="API实现Pointcut"><!--[--><!--]--> API实现Pointcut <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aspectj拦截动作" class="router-link-active router-link-exact-active sidebar-item" aria-label="@AspectJ拦截动作"><!--[--><!--]--> @AspectJ拦截动作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#xml配置around-advice" class="router-link-active router-link-exact-active sidebar-item" aria-label="XML配置Around Advice"><!--[--><!--]--> XML配置Around Advice <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aspectj的前置动作" class="router-link-active router-link-exact-active sidebar-item" aria-label="@AspectJ的前置动作"><!--[--><!--]--> @AspectJ的前置动作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#xml配置before-advice" class="router-link-active router-link-exact-active sidebar-item" aria-label="XML配置Before Advice"><!--[--><!--]--> XML配置Before Advice <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aspect后置动作" class="router-link-active router-link-exact-active sidebar-item" aria-label="@Aspect后置动作"><!--[--><!--]--> @Aspect后置动作 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#xml配置after-advice" class="router-link-active router-link-exact-active sidebar-item" aria-label="XML配置After Advice"><!--[--><!--]--> XML配置After Advice <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#api实现after-advice" class="router-link-active router-link-exact-active sidebar-item" aria-label="API实现After Advice"><!--[--><!--]--> API实现After Advice <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#自动动态代理" class="router-link-active router-link-exact-active sidebar-item" aria-label="自动动态代理"><!--[--><!--]--> 自动动态代理 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#替换targetsource" class="router-link-active router-link-exact-active sidebar-item" aria-label="替换TargetSource"><!--[--><!--]--> 替换TargetSource <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#面试题-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="面试题"><!--[--><!--]--> 面试题 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#spring-aop支持哪些类型的advice" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP支持哪些类型的Advice？"><!--[--><!--]--> Spring AOP支持哪些类型的Advice？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring-aop编程模型有哪些-代表组件有哪些" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP编程模型有哪些，代表组件有哪些？"><!--[--><!--]--> Spring AOP编程模型有哪些，代表组件有哪些？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring-aop三种实现方式是如何进行设计的" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP三种实现方式是如何进行设计的？"><!--[--><!--]--> Spring AOP三种实现方式是如何进行设计的？ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#api整体设计" class="router-link-active router-link-exact-active sidebar-item" aria-label="API整体设计"><!--[--><!--]--> API整体设计 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#接入点接口joinpoint" class="router-link-active router-link-exact-active sidebar-item" aria-label="接入点接口Joinpoint"><!--[--><!--]--> 接入点接口Joinpoint <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#joinpoint条件接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="Joinpoint条件接口"><!--[--><!--]--> Joinpoint条件接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#pointcut组合实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Pointcut组合实现"><!--[--><!--]--> Pointcut组合实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#pointcut便利实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Pointcut便利实现"><!--[--><!--]--> Pointcut便利实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#pointcut-aspectj实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Pointcut AspectJ实现"><!--[--><!--]--> Pointcut AspectJ实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#joinpoint执行动作接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="Joinpoint执行动作接口"><!--[--><!--]--> Joinpoint执行动作接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#before-advice标准实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Before Advice标准实现"><!--[--><!--]--> Before Advice标准实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#before-advice-aspectj实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Before Advice AspectJ实现"><!--[--><!--]--> Before Advice AspectJ实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#after-advice标准实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="After Advice标准实现"><!--[--><!--]--> After Advice标准实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#after-advice-aspectj实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="After Advice AspectJ实现"><!--[--><!--]--> After Advice AspectJ实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#advisor接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="Advisor接口"><!--[--><!--]--> Advisor接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#pointcutadvisor接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="PointcutAdvisor接口"><!--[--><!--]--> PointcutAdvisor接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#intorductionadvisor接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="IntorductionAdvisor接口"><!--[--><!--]--> IntorductionAdvisor接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#advisoradapter接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="AdvisorAdapter接口"><!--[--><!--]--> AdvisorAdapter接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aopproxy接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="AopProxy接口"><!--[--><!--]--> AopProxy接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aopproxyfactory" class="router-link-active router-link-exact-active sidebar-item" aria-label="AopProxyFactory"><!--[--><!--]--> AopProxyFactory <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#jdk-aopproxy实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="JDK AopProxy实现"><!--[--><!--]--> JDK AopProxy实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#cglib-aopproxy实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="CGLIB AopProxy实现"><!--[--><!--]--> CGLIB AopProxy实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#advisedsupport" class="router-link-active router-link-exact-active sidebar-item" aria-label="AdvisedSupport"><!--[--><!--]--> AdvisedSupport <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#advisorchainfactory接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="AdvisorChainFactory接口"><!--[--><!--]--> AdvisorChainFactory接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#targetsource接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="TargetSource接口"><!--[--><!--]--> TargetSource接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#proxycreatorsupport" class="router-link-active router-link-exact-active sidebar-item" aria-label="ProxyCreatorSupport"><!--[--><!--]--> ProxyCreatorSupport <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#advisedsupportlistener" class="router-link-active router-link-exact-active sidebar-item" aria-label="AdvisedSupportListener"><!--[--><!--]--> AdvisedSupportListener <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#proxyfactory" class="router-link-active router-link-exact-active sidebar-item" aria-label="ProxyFactory"><!--[--><!--]--> ProxyFactory <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#proxyfactorybean" class="router-link-active router-link-exact-active sidebar-item" aria-label="ProxyFactoryBean"><!--[--><!--]--> ProxyFactoryBean <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aspectjproxyfactory" class="router-link-active router-link-exact-active sidebar-item" aria-label="AspectJProxyFactory"><!--[--><!--]--> AspectJProxyFactory <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#abstractautoproxycreator" class="router-link-active router-link-exact-active sidebar-item" aria-label="AbstractAutoProxyCreator"><!--[--><!--]--> AbstractAutoProxyCreator <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#ioc容器自动代理标准实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="IoC容器自动代理标准实现"><!--[--><!--]--> IoC容器自动代理标准实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aspectjawareadvisorautoproxycreator" class="router-link-active router-link-exact-active sidebar-item" aria-label="AspectJAwareAdvisorAutoProxyCreator"><!--[--><!--]--> AspectJAwareAdvisorAutoProxyCreator <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aopinfrastructurebean接口" class="router-link-active router-link-exact-active sidebar-item" aria-label="AopInfrastructureBean接口"><!--[--><!--]--> AopInfrastructureBean接口 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aopcontext" class="router-link-active router-link-exact-active sidebar-item" aria-label="AopContext"><!--[--><!--]--> AopContext <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aopproxyutils" class="router-link-active router-link-exact-active sidebar-item" aria-label="AopProxyUtils"><!--[--><!--]--> AopProxyUtils <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aoputils" class="router-link-active router-link-exact-active sidebar-item" aria-label="AopUtils"><!--[--><!--]--> AopUtils <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aspectj-enable模块驱动" class="router-link-active router-link-exact-active sidebar-item" aria-label="AspectJ Enable模块驱动"><!--[--><!--]--> AspectJ Enable模块驱动 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aspectj-xml配置驱动实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="AspectJ XML配置驱动实现"><!--[--><!--]--> AspectJ XML配置驱动实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aop-config-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="&lt;aop:config /&gt; Schema-based实现"><!--[--><!--]--> &lt;aop:config /&gt; Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#aop-aspect-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="&lt;aop:aspect /&gt; Schema-based实现"><!--[--><!--]--> &lt;aop:aspect /&gt; Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#pointcut-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Pointcut Schema-based实现"><!--[--><!--]--> Pointcut Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#around-advice-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Around Advice Schema-based实现"><!--[--><!--]--> Around Advice Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#before-advice-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Before Advice Schema-based实现"><!--[--><!--]--> Before Advice Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#after-advice-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="After Advice Schema-based实现"><!--[--><!--]--> After Advice Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#after-returning-advice-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="After Returning Advice Schema-based实现"><!--[--><!--]--> After Returning Advice Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#after-throwing-advice-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="After Throwing Advice Schema-based实现"><!--[--><!--]--> After Throwing Advice Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#advisor-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Advisor Schema-based实现"><!--[--><!--]--> Advisor Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#introduction-schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="Introduction Schema-based实现"><!--[--><!--]--> Introduction Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#作用域代理schema-based实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="作用域代理Schema-based实现"><!--[--><!--]--> 作用域代理Schema-based实现 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#面试题-2" class="router-link-active router-link-exact-active sidebar-item" aria-label="面试题"><!--[--><!--]--> 面试题 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#spring-aop-advice-xml标签有哪些" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP Advice XML标签有哪些？"><!--[--><!--]--> Spring AOP Advice XML标签有哪些？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#请解释spring-enbaleaspectjautoproxy的原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="请解释Spring @EnbaleAspectJAutoProxy的原理？"><!--[--><!--]--> 请解释Spring @EnbaleAspectJAutoProxy的原理？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring-configuration-class-cglib提升与aop类代理的关系" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring Configuration Class CGLIB提升与AOP类代理的关系？"><!--[--><!--]--> Spring Configuration Class CGLIB提升与AOP类代理的关系？ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#创建型模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="创建型模式"><!--[--><!--]--> 创建型模式 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#抽象工厂模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="抽象工厂模式"><!--[--><!--]--> 抽象工厂模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#构建器模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="构建器模式"><!--[--><!--]--> 构建器模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#工厂方法模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="工厂方法模式"><!--[--><!--]--> 工厂方法模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#原型模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="原型模式"><!--[--><!--]--> 原型模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#单例模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="单例模式"><!--[--><!--]--> 单例模式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#结构型模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="结构型模式"><!--[--><!--]--> 结构型模式 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#适配器模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="适配器模式"><!--[--><!--]--> 适配器模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#组合模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="组合模式"><!--[--><!--]--> 组合模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#装饰器模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="装饰器模式"><!--[--><!--]--> 装饰器模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#享元模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="享元模式"><!--[--><!--]--> 享元模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#代理模式-1" class="router-link-active router-link-exact-active sidebar-item" aria-label="代理模式"><!--[--><!--]--> 代理模式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#行为型模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="行为型模式"><!--[--><!--]--> 行为型模式 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#模板方法模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="模板方法模式"><!--[--><!--]--> 模板方法模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#责任链模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="责任链模式"><!--[--><!--]--> 责任链模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#观察者模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="观察者模式"><!--[--><!--]--> 观察者模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#策略模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="策略模式"><!--[--><!--]--> 策略模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#命令模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="命令模式"><!--[--><!--]--> 命令模式 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#状态模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="状态模式"><!--[--><!--]--> 状态模式 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#面试题-3" class="router-link-active router-link-exact-active sidebar-item" aria-label="面试题"><!--[--><!--]--> 面试题 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#gof-23设计模式和它的归类" class="router-link-active router-link-exact-active sidebar-item" aria-label="GOF 23设计模式和它的归类？"><!--[--><!--]--> GOF 23设计模式和它的归类？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#举例装饰器模式和代理模式的区别" class="router-link-active router-link-exact-active sidebar-item" aria-label="举例装饰器模式和代理模式的区别？"><!--[--><!--]--> 举例装饰器模式和代理模式的区别？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#请举例说明spring-framework中使用设计模式的实现" class="router-link-active router-link-exact-active sidebar-item" aria-label="请举例说明Spring Framework中使用设计模式的实现？"><!--[--><!--]--> 请举例说明Spring Framework中使用设计模式的实现？ <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#spring-事件中的应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring 事件中的应用"><!--[--><!--]--> Spring 事件中的应用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring事务中的应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring事务中的应用"><!--[--><!--]--> Spring事务中的应用 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#核心api" class="router-link-active router-link-exact-active sidebar-item" aria-label="核心API"><!--[--><!--]--> 核心API <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#理解transactiondefinition" class="router-link-active router-link-exact-active sidebar-item" aria-label="理解TransactionDefinition"><!--[--><!--]--> 理解TransactionDefinition <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#理解platformtransactionmanager" class="router-link-active router-link-exact-active sidebar-item" aria-label="理解PlatformTransactionManager"><!--[--><!--]--> 理解PlatformTransactionManager <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#理解事务传播" class="router-link-active router-link-exact-active sidebar-item" aria-label="理解事务传播"><!--[--><!--]--> 理解事务传播 <!--[--><!--]--></a><!----></li><!--]--></ul></li><li><a aria-current="page" href="/framework/spring_aop/#spring-缓存中的应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring 缓存中的应用"><!--[--><!--]--> Spring 缓存中的应用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring本地调度中的应用" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring本地调度中的应用"><!--[--><!--]--> Spring本地调度中的应用 <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#面试题-4" class="router-link-active router-link-exact-active sidebar-item" aria-label="面试题"><!--[--><!--]--> 面试题 <!--[--><!--]--></a><ul style="" class="sidebar-item-children"><!--[--><li><a aria-current="page" href="/framework/spring_aop/#spring-aop在spring-framework特性运用" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP在Spring Framework特性运用？"><!--[--><!--]--> Spring AOP在Spring Framework特性运用？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring事务传播的原理" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring事务传播的原理？"><!--[--><!--]--> Spring事务传播的原理？ <!--[--><!--]--></a><!----></li><li><a aria-current="page" href="/framework/spring_aop/#spring-aop与ioc功能整合的设计模式" class="router-link-active router-link-exact-active sidebar-item" aria-label="Spring AOP与IoC功能整合的设计模式？"><!--[--><!--]--> Spring AOP与IoC功能整合的设计模式？ <!--[--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="page"><!--[--><!--]--><div class="theme-default-content"><!--[--><!--]--><div><p>AOP（Aspect Oriented Programming）面向切面编程，是针对面向对象编程的一种补充，同时也是Spring中第二个最核心的功能。在学习AOP之前，可以首先了解有关于Spring IoC的相关内容：<a href="https://jycoder.club/2020/07/16/SpringFramework/" target="_blank" rel="noopener noreferrer">Spring Framework<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a>。</p><!-- more --><h1 id="spring-aop总览" tabindex="-1"><a class="header-anchor" href="#spring-aop总览" aria-hidden="true">#</a> Spring AOP总览</h1><h2 id="知识储备" tabindex="-1"><a class="header-anchor" href="#知识储备" aria-hidden="true">#</a> 知识储备</h2><h3 id="java-基础部分" tabindex="-1"><a class="header-anchor" href="#java-基础部分" aria-hidden="true">#</a> Java 基础部分</h3><ul><li>Java 类加载器</li><li>Java 动态代理</li><li>Java 反射</li><li>字节码框架：ASM、CGLB</li></ul><p>类加载器的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ClassLoaderDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ClassLoader</span> parent <span class="token operator">=</span> classLoader<span class="token punctuation">;</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            parent <span class="token operator">=</span> parent<span class="token punctuation">.</span><span class="token function">getParent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>parent <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">break</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>parent<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到，这里我们使用的其实就是AppClassLoader，而AppClassLoader又继承了URLClassLoader，因此在使用loadClass方法加载类文件的时候，通过我们只需要传递类全名即可，而无需获取全路径。</p><p>关于字节码框架部分，Spring内连了ASM框架。</p><p><img src="https://blog-1304855543.cos.ap-guangzhou.myqcloud.com/blog/img/20210712104931.png" alt="image-20210712104930912"></p><h3 id="oop-部分" tabindex="-1"><a class="header-anchor" href="#oop-部分" aria-hidden="true">#</a> OOP 部分</h3><p>面向对象三大特性：</p><ul><li>封装</li><li>继承</li><li>多态</li></ul><h3 id="gof23-设计模式" tabindex="-1"><a class="header-anchor" href="#gof23-设计模式" aria-hidden="true">#</a> GOF23 设计模式</h3><p>创建模式：</p><ul><li>抽象工程模式</li><li>构建器模式</li><li>工厂方法模式</li><li>原型模式</li><li>单例模式</li></ul><p>结构模式：</p><ul><li>适配器模式</li><li>桥接模式</li><li>组合模式</li><li>装饰器模式</li><li>门面模式</li><li>亨元模式</li><li>代理模式</li></ul><p>行为模式：</p><ul><li>模板方法模式</li><li>中继器模式</li><li>责任链模式</li><li>观察者模式</li><li>策略模式</li><li>命令模式</li><li>状态模式</li><li>访问者模式</li><li>解释器模式、迭代器模式、备忘录模式</li></ul><h3 id="spring-核心基础" tabindex="-1"><a class="header-anchor" href="#spring-核心基础" aria-hidden="true">#</a> Spring 核心基础</h3><ul><li>Spring IoC容器</li><li>Spring Bean生命周期</li><li>Spring 配置元信息</li><li>Spring 事件</li><li>Spring 注解</li></ul><h3 id="oop局限性" tabindex="-1"><a class="header-anchor" href="#oop局限性" aria-hidden="true">#</a> OOP局限性</h3><p>Java OOP存在哪些局限性？</p><ul><li>静态化语言：类结构一旦定义，不容易被修改</li><li>侵入性扩展：通过继承和组合组织新的类结构</li></ul><blockquote><p>静态语言即强类型语言，是指在编译时变量的数据类型即可确定的语言，典型的代表有C++、Java、Delphi、C#等。</p></blockquote><h2 id="aop常见使用场景" tabindex="-1"><a class="header-anchor" href="#aop常见使用场景" aria-hidden="true">#</a> AOP常见使用场景</h2><h3 id="日志场景" tabindex="-1"><a class="header-anchor" href="#日志场景" aria-hidden="true">#</a> 日志场景</h3><ul><li>诊断上下文，如：log4j或logback中的MDC</li><li>辅助信息，如：方法执行时间</li></ul><h3 id="统计场景" tabindex="-1"><a class="header-anchor" href="#统计场景" aria-hidden="true">#</a> 统计场景</h3><ul><li>方法调用次数</li><li>执行异常次数</li><li>数据抽样</li><li>数值累加</li></ul><h3 id="安防场景" tabindex="-1"><a class="header-anchor" href="#安防场景" aria-hidden="true">#</a> 安防场景</h3><ul><li>熔断，如：Netflix Hystrix</li><li>限流和降级：如：Ablibba Sentinel</li><li>认证和授权，如：Spring Security</li><li>监控，如JMX</li></ul><h3 id="性能场景" tabindex="-1"><a class="header-anchor" href="#性能场景" aria-hidden="true">#</a> 性能场景</h3><ul><li>缓存，如Spring Cache</li><li>超时控制</li></ul><h2 id="java-aop设计模式" tabindex="-1"><a class="header-anchor" href="#java-aop设计模式" aria-hidden="true">#</a> Java AOP设计模式</h2><p>Spring仅支持基于代理模式的AOP实现，除此之外，AOP还可以是：</p><ul><li><p>代理模式：静态和动态代理</p></li><li><p>判断模式：类、方法、注解、参数、异常....</p></li><li><p>拦截模式：前置、后置、返回、异常</p></li></ul><h3 id="代理模式" tabindex="-1"><a class="header-anchor" href="#代理模式" aria-hidden="true">#</a> 代理模式</h3><p>Java静态代理的实现方式：</p><ul><li>常用OOP继承和组合相结合</li></ul><p>Java动态代理的实现方式：</p><ul><li>JDK动态代理</li><li>字节码提升，如CGLIB</li><li>AspectJ</li></ul><p>无论是静态代理还是动态代理都是基于接口，首先定义一个接口：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EchoService</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">echo</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>编写这个接口的默认实现：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DefaultEchoService</span> <span class="token keyword">implements</span> <span class="token class-name">EchoService</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">echo</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;[ECHO]&quot;</span> <span class="token operator">+</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>静态代理类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyEchoService</span> <span class="token keyword">implements</span> <span class="token class-name">EchoService</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">EchoService</span> echoService<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">ProxyEchoService</span><span class="token punctuation">(</span><span class="token class-name">EchoService</span> echoService<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>echoService <span class="token operator">=</span> echoService<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">echo</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> result <span class="token operator">=</span> echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">long</span> costTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;echo方法执行时间: &quot;</span> <span class="token operator">+</span> costTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> result<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用静态代理类的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticProxyDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ProxyEchoService</span> proxyEchoService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyEchoService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultEchoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxyEchoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>动态代理的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">JdkDynamicProxyDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> proxy <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">InvocationHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">invoke</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">ProxyEchoService</span> echoService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyEchoService</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultEchoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token keyword">return</span> echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">)</span> proxy<span class="token punctuation">;</span>
        echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="判断模式" tabindex="-1"><a class="header-anchor" href="#判断模式" aria-hidden="true">#</a> 判断模式</h3><p>判断来源：</p><p>类型（Class）、方法（Method）、注解（Annotation）、参数（Parameter）、异常（Exception）</p><p>在EchoService#echo中抛出一个异常：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">EchoService</span> <span class="token punctuation">{</span>

    <span class="token class-name">String</span> <span class="token function">echo</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>判断模式的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">TargetFilterDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">ClassNotFoundException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> targetClassName <span class="token operator">=</span> <span class="token string">&quot;org.jyc.thinking.in.spring.aop.overview.EchoService&quot;</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取当前线程ClassLoader</span>
        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取目标类</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass <span class="token operator">=</span> classLoader<span class="token punctuation">.</span><span class="token function">loadClass</span><span class="token punctuation">(</span>targetClassName<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 过滤名称</span>
        <span class="token class-name">Method</span> method <span class="token operator">=</span> <span class="token class-name">ReflectionUtils</span><span class="token punctuation">.</span><span class="token function">findMethod</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">,</span> <span class="token string">&quot;echo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 查找方法throws类型为 NullPointerException</span>
        <span class="token class-name">ReflectionUtils</span><span class="token punctuation">.</span><span class="token function">doWithMethods</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">,</span> method1 <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;仅抛出NullPointerException的方法为：&quot;</span> <span class="token operator">+</span> method1<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> method2 <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> parameterTypes <span class="token operator">=</span> method2<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> exceptionTypes <span class="token operator">=</span> method2<span class="token punctuation">.</span><span class="token function">getExceptionTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 异常列表长度为1并且异常类型为NullPointerException，参数列表为1并且，参数类型为String的方法</span>
            <span class="token keyword">return</span> exceptionTypes<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">NullPointerException</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>exceptionTypes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
                    <span class="token operator">&amp;&amp;</span> parameterTypes<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>parameterTypes<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="拦截模式" tabindex="-1"><a class="header-anchor" href="#拦截模式" aria-hidden="true">#</a> 拦截模式</h3><p>拦截类型大致分为三种：</p><ul><li>前置拦截（Before）</li><li>后置拦截（After）</li><li>异常拦截（Exception）</li></ul><p>定义前置拦截器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">BeforeInterceptor</span> <span class="token punctuation">{</span>
    <span class="token class-name">Object</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span><span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>定义后置拦截器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FinallyInterceptor</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">returnResult</span> 方法的返回结果
     */</span>
    <span class="token class-name">Object</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> returnResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>定义异常拦截器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">FinallyInterceptor</span> <span class="token punctuation">{</span>
    <span class="token doc-comment comment">/**
     * <span class="token keyword">@param</span> <span class="token parameter">returnResult</span> 方法的返回结果
     */</span>
    <span class="token class-name">Object</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> returnResult<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用以上拦截器的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AopInterceptorDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args2<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 前置模式 + 后置模式</span>
        <span class="token class-name">ClassLoader</span> classLoader <span class="token operator">=</span> <span class="token class-name">Thread</span><span class="token punctuation">.</span><span class="token function">currentThread</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getContextClassLoader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">Object</span> proxy2 <span class="token operator">=</span> <span class="token class-name">Proxy</span><span class="token punctuation">.</span><span class="token function">newProxyInstance</span><span class="token punctuation">(</span>classLoader<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getDeclaringClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 前置拦截器</span>
                <span class="token class-name">BeforeInterceptor</span> beforeInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BeforeInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token annotation punctuation">@Override</span>
                    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token keyword">return</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token punctuation">}</span>
                <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token class-name">Long</span> startTime <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
                <span class="token class-name">Long</span> endTime <span class="token operator">=</span> <span class="token number">0L</span><span class="token punctuation">;</span>
                <span class="token class-name">Object</span> result <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
                <span class="token keyword">try</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 前置拦截</span>
                    startTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> beforeInterceptor<span class="token punctuation">.</span><span class="token function">before</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEchoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    result <span class="token operator">=</span> echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token comment">// 方法执行后置拦截器</span>
                    <span class="token class-name">AfterReturnInterceptor</span> afterReturnInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AfterReturnInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">after</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> returnResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token keyword">return</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                    endTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> afterReturnInterceptor<span class="token punctuation">.</span><span class="token function">after</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token comment">// 异常拦截器</span>
                    <span class="token class-name">ExceptionInterceptor</span> exceptionInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ExceptionInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                        <span class="token annotation punctuation">@Override</span>
                        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">intercpt</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Throwable</span> throwable<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                            <span class="token comment">// ...</span>
                        <span class="token punctuation">}</span>
                    <span class="token punctuation">}</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span>
                    <span class="token comment">// finally 后置拦截器</span>
                    <span class="token class-name">FinallyInterceptor</span> finallyInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">TimeFinallyInterceptor</span><span class="token punctuation">(</span>startTime<span class="token punctuation">,</span> endTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">Long</span> costTime <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Long</span><span class="token punctuation">)</span> finallyInterceptor<span class="token punctuation">.</span><span class="token function">finalize</span><span class="token punctuation">(</span>proxy<span class="token punctuation">,</span> method<span class="token punctuation">,</span> args<span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;echo方法执行时间: &quot;</span> <span class="token operator">+</span> costTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
            <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">)</span> proxy2<span class="token punctuation">;</span>
        echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TimeFinallyInterceptor</span> <span class="token keyword">implements</span> <span class="token class-name">FinallyInterceptor</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> startTime<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">Long</span> endTime<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token class-name">TimeFinallyInterceptor</span><span class="token punctuation">(</span><span class="token class-name">Long</span> startTime<span class="token punctuation">,</span> <span class="token class-name">Long</span> endTime<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>startTime <span class="token operator">=</span> startTime<span class="token punctuation">;</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>endTime <span class="token operator">=</span> endTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">finalize</span><span class="token punctuation">(</span><span class="token class-name">Object</span> proxy<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> returnResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> endTime <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="spring-aop-功能概述" tabindex="-1"><a class="header-anchor" href="#spring-aop-功能概述" aria-hidden="true">#</a> Spring AOP 功能概述</h2><h3 id="aop设计核心" tabindex="-1"><a class="header-anchor" href="#aop设计核心" aria-hidden="true">#</a> AOP设计核心</h3><p>Spring AOP 的整体设计如下：</p><img src="https://cdn.jsdelivr.net/gh/liu844869663/cdn@master/SpringAOP/Spring AOP API.png" style="zoom:50%;"><ul><li>切面（Aspect）：一个关注点的模块化，在Spring AOP中。</li><li>连接点（Join Point）：在程序执行过程中某个特定的点，比如方法调用的时候或异常处理的时候。</li><li>通知（Advice）：在切面的某个特定的连接点上执行的动作。</li><li>切入点（Pointcut）：匹配连接点的断言，通知和一个切入点表达式关联，并在满足这个切入点的连接点上运行。</li><li>织入（Weaving）：把切面连接到其他应用程序类型或者对象上，并创建一个被通知的对象。</li></ul><img src="https://blog-1304855543.cos.ap-guangzhou.myqcloud.com/blog/img/20210718125653.jpeg" style="zoom:50%;"><p>核心特性：</p><ul><li>纯Java实现、无编译时特殊处理，不修改和控制ClassLoader</li><li>仅支持方法级别的Join Points</li><li>非完整AOP实现框架</li><li>Spring IoC容器整合</li><li>AspectJ注解驱动整合（非竞争关系）</li></ul><h3 id="spring-aop编程模型" tabindex="-1"><a class="header-anchor" href="#spring-aop编程模型" aria-hidden="true">#</a> Spring AOP编程模型</h3><p>Spring AOP编程模型也主要分为三种：注解驱动、XML配置驱动和底层API</p><p>注解驱动：</p><ul><li>实现：Enable模块驱动，@EnableAspectJAutpProxy</li><li>注解： <ul><li>激活AspectJ自动代理：@EnableAspectJAutoProxy</li><li>Aspect：@Aspect</li><li>pointcut：@Pointcut</li><li>Advice：@Before、@AfterReturning、@AfterThrowing、@After、@Around</li><li>introduction：@DeclareParents</li></ul></li></ul><p>XML配置驱动：</p><ul><li>实现：Spring Extensble XML Authoring</li><li>XML元素 <ul><li>激活AspectJ自动代理：&lt;aop:aspectj-autoproxy /&gt;</li><li>配置：&lt;aop:config /&gt;</li><li>Aspect：&lt;aop:aspect /&gt;</li><li>Pointcut：&lt;aop:pointcut /&gt;</li><li>Advice：&lt;aop:around /&gt;、&lt;aop:before /&gt;、&lt;aop:after-returning /&gt;、&lt;aop:after-throwing /&gt;和&lt;aop:after /&gt;</li><li>introduction：&lt;aop:declare-parents /&gt;</li><li>代理Scope：&lt;aop:scoped-proxy /&gt;</li></ul></li></ul><p>底层API：</p><ul><li><p>实现：JDK动态代理、CGLIB以及AspectJ</p></li><li><p>API：</p><ul><li>代理：AopProxy</li><li>配置：ProxyConfig</li><li>Join Point：JoinPoint</li><li>Pointcut：Ponintcut</li><li>Advice：Advice、BeforeAdvice、AfterAdvice、AfterReturningAdvice、ThrowsAdvice</li></ul></li></ul><h3 id="spring-aop-advice类型" tabindex="-1"><a class="header-anchor" href="#spring-aop-advice类型" aria-hidden="true">#</a> Spring AOP Advice类型</h3><p>Advice类型：环绕（Around）、前置（Before）、后置（After）、异常（Exception），其中后置又包括了方法执行和finally执行两种。</p><h3 id="spring-aop代理实现" tabindex="-1"><a class="header-anchor" href="#spring-aop代理实现" aria-hidden="true">#</a> Spring AOP代理实现</h3><p>Spring AOP的代理实现主要有三种：</p><ul><li>JDK动态代理实现 - 基于接口代理 <ul><li>org.springframework.aop.framework.JdkDynamicAopProxy</li></ul></li><li>CGLIB动态代理实现 - 基于类代理（字节码提升） <ul><li>org.springframework.aop.framework.CglibAopProxy</li></ul></li><li>AspectJ适配实现 <ul><li>org.springframework.aop.aspectj.annotation.AspectJProxyFactory</li></ul></li></ul><p>无论是哪一种实现，都实现了AopProxy接口，并且实现类都是非public的。</p><h4 id="jdk动态代理" tabindex="-1"><a class="header-anchor" href="#jdk动态代理" aria-hidden="true">#</a> JDK动态代理</h4><p>为什么Proxy.newProxyInstance会生成新的字节码？</p><p><img src="https://blog-1304855543.cos.ap-guangzhou.myqcloud.com/blog/img/20210714132854.png" alt="image-20210714132854720"></p><p>JDK会操作字符数组，生成一个代理类的Class对象。</p><h4 id="cglib动态代理" tabindex="-1"><a class="header-anchor" href="#cglib动态代理" aria-hidden="true">#</a> CGLIB动态代理</h4><p>在Java中，面向对象通常而言指的是面向接口编程，或者也可以认为是面向锲约编程，JDK的动态代理会依赖于接口的定义，在没有定义接口的情况，还要实现AOP的功能，就需要CGLIB动态代理来实现。</p><p>使用CGLIB动态代理的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">CglibDynamicProxyDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Enhancer</span> enhancer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Enhancer</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 指定super Class = DefaultEchoService.class</span>
        <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">DefaultEchoService</span><span class="token punctuation">&gt;</span></span> superClass <span class="token operator">=</span> <span class="token class-name">DefaultEchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setSuperclass</span><span class="token punctuation">(</span>superClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 指定拦截接口</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setInterfaces</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        enhancer<span class="token punctuation">.</span><span class="token function">setCallback</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">intercept</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">MethodProxy</span> methodProxy<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token keyword">long</span> startTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token comment">// Source -&gt; CGLIB子类</span>
                <span class="token comment">// 目标类 -&gt; DefaultEchoService</span>
                <span class="token comment">// 错误使用</span>
<span class="token comment">//                Object result = method.invoke(source, args);</span>
                <span class="token class-name">Object</span> result <span class="token operator">=</span> methodProxy<span class="token punctuation">.</span><span class="token function">invokeSuper</span><span class="token punctuation">(</span>source<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">long</span> costTime <span class="token operator">=</span> <span class="token class-name">System</span><span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> startTime<span class="token punctuation">;</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;[CGLIB字节码提升]echo方法执行时间: &quot;</span> <span class="token operator">+</span> costTime<span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token keyword">return</span> result<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建代理对象</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">)</span>enhancer<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 输出结果</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="aspectj代理" tabindex="-1"><a class="header-anchor" href="#aspectj代理" aria-hidden="true">#</a> AspectJ代理</h4><p>借助于AspectJ强大的编译器，AspectJ有一套自己的语法，AspectJ的主要语法有：Aspect、Join Points、Pointcuts、Advice、introduction。</p><p>在注解方面，Spring和AspectJ的注解名称是相同的，不过在具体处理的时候略有差异。</p><h2 id="面试题" tabindex="-1"><a class="header-anchor" href="#面试题" aria-hidden="true">#</a> 面试题</h2><h3 id="spring-aop和aspectj-aop存在哪些差别" tabindex="-1"><a class="header-anchor" href="#spring-aop和aspectj-aop存在哪些差别" aria-hidden="true">#</a> Spring AOP和AspectJ AOP存在哪些差别？</h3><ul><li>AspectJ是AOP完整实现，Spring AOP则是部分实现</li><li>Spring AOP比AspectJ使用更简单</li><li>Spring AOP整合AspectJ注解与Spring IoC容器</li><li>Spring AOP仅支持基于代理模式的AOP</li><li>Spring AOP仅支持方法级别的Pointcuts</li></ul><h1 id="spring-aop基础" tabindex="-1"><a class="header-anchor" href="#spring-aop基础" aria-hidden="true">#</a> Spring AOP基础</h1><h2 id="aspectj注解驱动" tabindex="-1"><a class="header-anchor" href="#aspectj注解驱动" aria-hidden="true">#</a> @AspectJ注解驱动</h2><p>激活@AspectJ模块的方式：</p><ul><li>注解激活 - @EnableAspectJAutoProxy</li><li>XML配置 - &lt;aop:aspectj-autoproxy /&gt;</li></ul><blockquote><p>如果使用的是SpringBoot，直接引入相关依赖就会自动激活，无需上述操作。</p></blockquote><p>声明Aspect：</p><ul><li>@Aspect</li></ul><p>使用注解激活的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Aspect</span> <span class="token comment">// 声名为切面类</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span> <span class="token comment">// 激活Aspect 注解自动代理</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectJAnnotationDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">AspectJAnnotationDemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AspectJAnnotationDemo</span> aspectJAnnotationDemo <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">AspectJAnnotationDemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aspectJAnnotationDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>类似的，使用XML方式激活：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span> <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
       <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
       http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.springframework.org/schema/aop
       http://www.springframework.org/schema/beans/spring-aop.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试激活结果：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@Aspect</span> <span class="token comment">// 声名为切面类</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectJXmlDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassPathXmlApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/META-INF/spring-aop-context.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AspectJXmlDemo</span> aspectJXmlDemo <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">AspectJXmlDemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>aspectJXmlDemo<span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="编程方式创建-aspectj代理" tabindex="-1"><a class="header-anchor" href="#编程方式创建-aspectj代理" aria-hidden="true">#</a> 编程方式创建@AspectJ代理</h2><p>实现类：org.springframework.aop.aspectj.annotation.AspectJProxyFactory</p><p>使用的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectJAnnotationUsingAPIDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 通过创建一个HashMap的缓存</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> cache <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">HashMap</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 创建proxy</span>
        <span class="token class-name">AspectJProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AspectJProxyFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 增加Aspect 配置类</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addAspect</span><span class="token punctuation">(</span><span class="token class-name">AspectConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MethodBeforeAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;put&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;当前存放是key：%s，value：%s \n&quot;</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">}</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 直接存储</span>
<span class="token comment">//        cache.put(&quot;1&quot;, &quot;A&quot;);</span>
        <span class="token comment">// 通过代理对象存储</span>
        <span class="token class-name">Map</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">String</span><span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">&gt;</span></span> proxy <span class="token operator">=</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>cache<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="标准工厂api" tabindex="-1"><a class="header-anchor" href="#标准工厂api" aria-hidden="true">#</a> 标准工厂API</h2><p>实现类：org.springframework.aop.framework.ProxyFactory</p><p>相关的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ProxyFactoryDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultEchoService</span> defaultEchoService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEchoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注入目标对象（被代理）</span>
        <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span>defaultEchoService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果对象存在接口的话，生成的代理对象还是JDK动态代理的</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">setTarget</span><span class="token punctuation">(</span><span class="token class-name">DefaultEchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加Advice</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EchoServiceMethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取代理对象</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">)</span>proxyFactory<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="aspectj-pointcut指令与表达式" tabindex="-1"><a class="header-anchor" href="#aspectj-pointcut指令与表达式" aria-hidden="true">#</a> @AspectJ Pointcut指令与表达式</h2><p>支持的指令：execution、within、this、target、args。</p><blockquote><p>pointcut只是用来筛选，而不会执行具体的动作，具体的动作由advice来执行，并且是一对多的关系。在Spring当中，pointcut的名称就是对应方法的名称。</p></blockquote><p>首先完善之前的Aspect的配置类：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectConfiguration</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(public * *(..))&quot;</span><span class="token punctuation">)</span>  <span class="token comment">// 匹配Join Point</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">anyPublicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// 方法名即Pointcut名称</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@Pointcut at any public method&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;anyPublicMethod()&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Join Point拦截动作</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeAnyPublicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@Before any public method.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>观察配置类的起的作用：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectJAnnotatedPointcutDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">AspectJAnnotatedPointcutDemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">AspectConfiguration</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">AspectJAnnotatedPointcutDemo</span> aspectJAnnotationDemo <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">AspectJAnnotatedPointcutDemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        aspectJAnnotationDemo<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;execute()...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到Pointcut对应的方法并没有被执行，这也验证了我们前面的结论。通常情况下，我们会将这个Pointcut声明的方法定义为private，并且方法当中没有实现，然后再advice当中引用。</p><h2 id="xml配置pointcut" tabindex="-1"><a class="header-anchor" href="#xml配置pointcut" aria-hidden="true">#</a> XML配置Pointcut</h2><p>XML配置的方式：&lt;aop:pointcut /&gt;</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span>
        <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>aop</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/aop<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>context</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/context<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd
        http://www.springframework.org/schema/aop
        https://www.springframework.org/schema/aop/spring-aop.xsd
        http://www.springframework.org/schema/context
        https://www.springframework.org/schema/context/spring-context.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspectj-autoproxy</span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aspectXmlConfig<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.jyc.thinking.in.spring.aop.features.aspect.AspectXmlConfiguration<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>AspectXmlConfig<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aspectXmlConfig<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>pointcut</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anyPublicMethod<span class="token punctuation">&quot;</span></span> <span class="token attr-name">expression</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>execution(public * *(..))<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>beforeAnyPublicMethod<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anyPublicMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>


    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>echoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.jyc.thinking.in.spring.aop.overview.DefaultEchoService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>观察使用XML方式来实现Pointcut：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectJSchemaBasedPointcutDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ClassPathXmlApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ClassPathXmlApplicationContext</span><span class="token punctuation">(</span><span class="token string">&quot;classpath:/META-INF/spring-aop-context.xml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用注解能够实现的，XML方式也都能实现。</p><h2 id="api实现pointcut" tabindex="-1"><a class="header-anchor" href="#api实现pointcut" aria-hidden="true">#</a> API实现Pointcut</h2><p>核心API - org.springframework.aop.Pointcut，其中有两个方法：</p><ul><li>org.springframework.aop.ClassFilter</li><li>org.springframework.aop.MethodMatcher</li></ul><p>适配实现 - DefaultPointcutAdvisor</p><p>相关的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PointcutApiDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">EchoServicePointcut</span> pointcut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EchoServicePointcut</span><span class="token punctuation">(</span><span class="token string">&quot;echo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将Pointcut适配成Advisor</span>
        <span class="token class-name">DefaultPointcutAdvisor</span> advisor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPointcutAdvisor</span><span class="token punctuation">(</span>pointcut<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">EchoServiceMethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DefaultEchoService</span> defaultEchoService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEchoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span>defaultEchoService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加Advisor</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvisor</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">)</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这里要注意的是，不能直接创建Pointcut对象，而是要通过适配的方式间接实现。</p><h2 id="aspectj拦截动作" tabindex="-1"><a class="header-anchor" href="#aspectj拦截动作" aria-hidden="true">#</a> @AspectJ拦截动作</h2><p>@Around 与@Before有什么区别呢？</p><p>首先我们在AspectConfiguration中定义一个@Around：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;anyPublicMethod()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">aroundAnyPublicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@Around any public method.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行时会发现，除了这行输出外没有其他任何信息，修改这个方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    <span class="token annotation punctuation">@Around</span><span class="token punctuation">(</span><span class="token string">&quot;anyPublicMethod()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">Object</span> <span class="token function">aroundAnyPublicMethod</span><span class="token punctuation">(</span><span class="token class-name">ProceedingJoinPoint</span> pjp<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@Around any public method.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> pjp<span class="token punctuation">.</span><span class="token function">proceed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到所有的信息均已成功打印，这是因为，@Around需要去显式的触发目标方法，而@Before则不用。</p><h2 id="xml配置around-advice" tabindex="-1"><a class="header-anchor" href="#xml配置around-advice" aria-hidden="true">#</a> XML配置Around Advice</h2><p>XML配置方式：&lt;aop:around /&gt;</p><p>类似的，我们将之前的aroundAnyPublicMethod方法添加到AspectXmlConfiguration，然后在XML中配置</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>around</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aroundAnyPublicMethod<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anyPublicMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h2 id="aspectj的前置动作" tabindex="-1"><a class="header-anchor" href="#aspectj的前置动作" aria-hidden="true">#</a> @AspectJ的前置动作</h2><p>Before Advice注解 - org.aspectj.lang.annotation.Before</p><p>@Before与@Around谁优先执行？</p><p>通过输出结果可以观察到，@Around先于@Before执行，这也是为什么Spring API里面没有提供@Around的Advice接口，因为它实际上都是通过拦截模式来操作的，只是@Before和@After以及@Around是不同的实现，所以不需要每一个单独有一个接口。</p><p>如果有多个@Before声明后，如何控制它们的顺序呢？答案是可以通过实现org.springframework.core.Ordered接口，或者使用@Order注解。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Aspect</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AspectConfiguration2</span> <span class="token keyword">implements</span> <span class="token class-name">Ordered</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@Pointcut</span><span class="token punctuation">(</span><span class="token string">&quot;execution(public * *(..))&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token keyword">void</span> <span class="token function">anyPublicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Before</span><span class="token punctuation">(</span><span class="token string">&quot;anyPublicMethod()&quot;</span><span class="token punctuation">)</span> <span class="token comment">// Join Point拦截动作</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">beforeAnyPublicMethod2</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@Before any public method.(2)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">getOrder</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这个时候程序执行的顺序就发生了变化，beforeAnyPublicMethod2优先于@Around方法执行了。要注意的是，这里不能定义最高优先级HIGHEST_PRECEDENCE。</p><h2 id="xml配置before-advice" tabindex="-1"><a class="header-anchor" href="#xml配置before-advice" aria-hidden="true">#</a> XML配置Before Advice</h2><p>XML元素的标签 - &lt;aop:before &gt;</p><ul><li><p>声明规则</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>before</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>属性设置（来源于Spring AOP Schema类型basicAdviceType）</p><ul><li>pointcut：Pointcut表达式内容</li><li>pointcut-ref：Pointcut表达式名称</li></ul><h2 id="api实现before-advice" tabindex="-1"><a class="header-anchor" href="#api实现before-advice" aria-hidden="true">#</a> API实现Before Advice</h2></li></ul><p>核心接口 - org.springframework.aop.BeforeAdvice</p><ul><li>类型：标记接口，与org.aopalliance.aop.Advice类似</li><li>方法JoinPoint扩展 - org.springframework.aop.MethodBeforeAdvice</li><li>接收对象 - org.springframework.aop.framework.AdvisedSupport <ul><li>基础实现类 - org.springframework.aop.framework.ProxyCreatorSupport <ul><li>常见实现类： <ul><li>org.springframework.aop.framework.ProxyFactory</li><li>org.springframework.aop.framework.ProxyFactoryBean</li><li>org.springframework.aop.aspectj.annotation.AspectJProxyFactory</li></ul></li></ul></li></ul></li></ul><h2 id="aspect后置动作" tabindex="-1"><a class="header-anchor" href="#aspect后置动作" aria-hidden="true">#</a> @Aspect后置动作</h2><p>After Advice注解：</p><ul><li>方法返回后：@org.aspectj.lang.annotation.AfterReturning</li><li>异常发生后：@org.aspectj.lang.annotation.AfterThrowing</li><li>finally执行：org.aspectj.lang.annotation.After</li></ul><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>	<span class="token annotation punctuation">@After</span><span class="token punctuation">(</span><span class="token string">&quot;anyPublicMethod()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">finalizeAnyPublicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@After any public method.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
    <span class="token annotation punctuation">@AfterReturning</span><span class="token punctuation">(</span><span class="token string">&quot;anyPublicMethod()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterAnyPublicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@AfterReturning any public method.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@AfterThrowing</span><span class="token punctuation">(</span><span class="token string">&quot;anyPublicMethod()&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowingAnyPublicMethod</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;@AfterThrowing any public method.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>其中@After方法会最后会被执行， @AfterThrowing会在方法抛出异常的时候执行。</p><h2 id="xml配置after-advice" tabindex="-1"><a class="header-anchor" href="#xml配置after-advice" aria-hidden="true">#</a> XML配置After Advice</h2><p>XML元素 - &lt;aop:after &gt;</p><ul><li><p>声明规则</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>config</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>aspect</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>属性设置（来源于Spring AOP Schema类型 basicAdviceType）</p><ul><li>pointcut：Pointcut表达式内容</li><li>pointcut-ref：Pointcut表达式名称</li></ul></li></ul><p>配置示例：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>finalizeAnyPublicMethod<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anyPublicMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-returning</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>afterAnyPublicMethod<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anyPublicMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">aop:</span>after-throwing</span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>afterThrowingAnyPublicMethod<span class="token punctuation">&quot;</span></span> <span class="token attr-name">pointcut-ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>anyPublicMethod<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="api实现after-advice" tabindex="-1"><a class="header-anchor" href="#api实现after-advice" aria-hidden="true">#</a> API实现After Advice</h2><p>核心接口 - org.springframework.aop.AfterAdvice</p><ul><li>类型：标记接口，与org.aopalliance.aop.Advice类似</li><li>扩展 <ul><li>org.springframework.aop.AfterReturningAdvice</li><li>org.springframework.aop.ThrowsAdvice</li></ul></li><li>接收对象 - org.springframework.aop.framework.AdvisedSupport <ul><li>基础实现类 - org.springframework.aop.framework.ProxyCreatorSupport <ul><li>常见实现类 <ul><li>org.springframework.aop.framework.ProxyFactory</li><li>org.springframework.aop.framework.ProxyFactoryBean</li><li>org.springframework.aop.aspectj.annotation.AspectJProxyFactory</li></ul></li></ul></li></ul></li></ul><p>相关的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>    proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AfterReturningAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterReturning</span><span class="token punctuation">(</span><span class="token class-name">Object</span> returnValue<span class="token punctuation">,</span> <span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string">&quot;put&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> args<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;[AfterReturningAdvice]当前存放是key：%s，新存放的value：%s \n,之前关联的Value：%s&quot;</span><span class="token punctuation">,</span>
                                  args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// key</span>
                                  args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// new value</span>
                                  returnValue <span class="token comment">// old value</span>
                                 <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自动动态代理" tabindex="-1"><a class="header-anchor" href="#自动动态代理" aria-hidden="true">#</a> 自动动态代理</h2><p>代表实现</p><ul><li>org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator</li><li>org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator</li><li>org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator</li></ul><p>相关的示例：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>beans</span>
        <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xmlns:</span>xsi</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.w3.org/2001/XMLSchema-instance<span class="token punctuation">&quot;</span></span>
        <span class="token attr-name"><span class="token namespace">xsi:</span>schemaLocation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://www.springframework.org/schema/beans
        https://www.springframework.org/schema/beans/spring-beans.xsd<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>echoService<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.jyc.thinking.in.spring.aop.overview.DefaultEchoService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- Advice Bean = MethodInterceptor Bean --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>echoServiceMethodInterceptor<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.jyc.thinking.in.spring.aop.features.interceptor.EchoServiceMethodInterceptor<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

<span class="token comment">&lt;!--        &lt;bean class=&quot;org.springframework.aop.framework.autoproxy.BeanNameAutoProxyCreator&quot;&gt;--&gt;</span>
<span class="token comment">&lt;!--            &lt;property name=&quot;beanNames&quot; value=&quot;*&quot;/&gt;--&gt;</span>
<span class="token comment">&lt;!--            &lt;property name=&quot;interceptorNames&quot;&gt;--&gt;</span>
<span class="token comment">&lt;!--                &lt;value&gt;echoServiceMethodInterceptor&lt;/value&gt;--&gt;</span>
<span class="token comment">&lt;!--            &lt;/property&gt;--&gt;</span>
<span class="token comment">&lt;!--        &lt;/bean&gt;--&gt;</span>

    <span class="token comment">&lt;!--  AutoProxy Bean  --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token comment">&lt;!-- Pointcut Bean --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>echoServicePointcut<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.jyc.thinking.in.spring.aop.features.pointcut.EchoServicePointcut<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>echo<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.jyc.thinking.in.spring.aop.overview.EchoService<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>

    <span class="token comment">&lt;!-- PointcutAdvisor Bean --&gt;</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>bean</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.aop.support.DefaultPointcutAdvisor<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>echoServicePointcut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>constructor-arg</span> <span class="token attr-name">index</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>1<span class="token punctuation">&quot;</span></span> <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>echoServiceMethodInterceptor<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>bean</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>beans</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="替换targetsource" tabindex="-1"><a class="header-anchor" href="#替换targetsource" aria-hidden="true">#</a> 替换TargetSource</h2><p>TargetSource（目标源）是被代理的target（目标对象）实例的来源。TargetSource被用于获取当前MethodInvocation（方法调用）所需要的目标对象target。换句话说，proxy代理的并不是target，而是targetSource对象。</p><p>通常情况下，一个代理对象只能代理一个target，每次方法调用目标也是唯一的target。但是如果让proxy代理TargetSource，可以使得每次方法调用的target实例都不相同。采用这种机制，可以使得方法的调用更加灵活。</p><p>代表实现：</p><ul><li>org.springframework.aop.target.HotSwappableTargetSource</li><li>org.springframework.aop.target.AbstractPoolingTargetSource</li><li>org.springframework.aop.target.PrototypeTargetSource</li><li>org.springframework.aop.target.ThreadLocalTargetSource</li><li>org.springframework.aop.target.SingletonTargetSource</li></ul><h2 id="面试题-1" tabindex="-1"><a class="header-anchor" href="#面试题-1" aria-hidden="true">#</a> 面试题</h2><h3 id="spring-aop支持哪些类型的advice" tabindex="-1"><a class="header-anchor" href="#spring-aop支持哪些类型的advice" aria-hidden="true">#</a> Spring AOP支持哪些类型的Advice？</h3><ul><li>Around Advice</li><li>Before Advice</li><li>After Advice <ul><li>After</li><li>AfterReturning</li><li>AfterThrowing</li></ul></li></ul><h3 id="spring-aop编程模型有哪些-代表组件有哪些" tabindex="-1"><a class="header-anchor" href="#spring-aop编程模型有哪些-代表组件有哪些" aria-hidden="true">#</a> Spring AOP编程模型有哪些，代表组件有哪些？</h3><p>注解驱动：解释和整合AspectJ注解，如@EnableAspectJAutoProxy</p><p>XML配置：AOP与IoC Schema-Based相结合</p><p>API编程：如JoinPoint、Pointcut、Advice和ProxyFactory等</p><h3 id="spring-aop三种实现方式是如何进行设计的" tabindex="-1"><a class="header-anchor" href="#spring-aop三种实现方式是如何进行设计的" aria-hidden="true">#</a> Spring AOP三种实现方式是如何进行设计的？</h3><p>// ...</p><h1 id="spring-aop设计与实现" tabindex="-1"><a class="header-anchor" href="#spring-aop设计与实现" aria-hidden="true">#</a> Spring AOP设计与实现</h1><h2 id="api整体设计" tabindex="-1"><a class="header-anchor" href="#api整体设计" aria-hidden="true">#</a> API整体设计</h2><ul><li>Join Point - Joinpoint</li><li>Pointcut - Pointcut</li><li>Advice执行动作 - Advice</li><li>Advice容器 - Advisor</li><li>Introduction - IntroductionInfo</li><li>代理对象创建基础类 - ProxyCreatorSupport</li><li>代理工厂 - ProxyFactory、ProxyFactorySupport</li><li>IoC容器自动代理抽象 - AbstractAutoProxyCreator</li></ul><h2 id="接入点接口joinpoint" tabindex="-1"><a class="header-anchor" href="#接入点接口joinpoint" aria-hidden="true">#</a> 接入点接口Joinpoint</h2><p>Interceptor执行上下文 - Invocation</p><ul><li>方法拦截器上下文 - MethodInvocation</li><li><s>构造器拦截器执行上下文 - ContructorInvocation</s></li></ul><p>MethodInvocation实现</p><ul><li>基于反射 - ReflectiveMethodInvocation</li><li>基于CGLIB实现 - CglibMethodInvocation</li></ul><blockquote><p>Spring AOP仅支持方法级别的拦截，构造器拦截只有在AspectJ中有相应的实现。</p></blockquote><h2 id="joinpoint条件接口" tabindex="-1"><a class="header-anchor" href="#joinpoint条件接口" aria-hidden="true">#</a> Joinpoint条件接口</h2><p>核心组件：</p><ul><li>类过滤器 - ClassFilter</li><li>方法匹配器 - MethodMatcher</li></ul><p>可以直接实现这个接口：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EchoServiceEchoMethodPointcut</span> <span class="token keyword">implements</span> <span class="token class-name">Pointcut</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token class-name">EchoServiceEchoMethodPointcut</span> <span class="token constant">INSTANCE</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EchoServiceEchoMethodPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">EchoServiceEchoMethodPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">ClassFilter</span> <span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">ClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> clazz<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">isAssignableFrom</span><span class="token punctuation">(</span>clazz<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 凡是EchoService接口或者子接口，子类均可</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">MethodMatcher</span> <span class="token function">getMethodMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MethodMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass<span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// echo(String)</span>
                <span class="token keyword">return</span> <span class="token string">&quot;echo&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
                        method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span>
                        <span class="token class-name">Objects</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> method<span class="token punctuation">.</span><span class="token function">getParameterTypes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">isRuntime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>测试拦截的效果：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PointcutApiDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">EchoServiceEchoMethodPointcut</span> pointcut <span class="token operator">=</span> <span class="token class-name">EchoServiceEchoMethodPointcut</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">;</span>
        <span class="token comment">// 将Pointcut适配成Advisor</span>
        <span class="token class-name">DefaultPointcutAdvisor</span> advisor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPointcutAdvisor</span><span class="token punctuation">(</span>pointcut<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">EchoServiceMethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DefaultEchoService</span> defaultEchoService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEchoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span>defaultEchoService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加Advisor</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvisor</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">)</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pointcut组合实现" tabindex="-1"><a class="header-anchor" href="#pointcut组合实现" aria-hidden="true">#</a> Pointcut组合实现</h2><p>组合实现 - org.springframework.aop.support.ComposablePointcut</p><p>这个API在实现的时候使用了一些工具类：</p><ul><li>ClassFilter工具类 - ClassFilters</li><li>MethodMatcher工具类 - MethodMatchers</li><li>Pointcut工具类 - Pointcuts</li></ul><p>其中有两个核心方法：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code>	<span class="token doc-comment comment">/**
	 * 求并集
	*/</span>
	<span class="token keyword">public</span> <span class="token class-name">ComposablePointcut</span> <span class="token function">union</span><span class="token punctuation">(</span><span class="token class-name">Pointcut</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>methodMatcher <span class="token operator">=</span> <span class="token class-name">MethodMatchers</span><span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span>
				<span class="token keyword">this</span><span class="token punctuation">.</span>methodMatcher<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>classFilter<span class="token punctuation">,</span> other<span class="token punctuation">.</span><span class="token function">getMethodMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> other<span class="token punctuation">.</span><span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>classFilter <span class="token operator">=</span> <span class="token class-name">ClassFilters</span><span class="token punctuation">.</span><span class="token function">union</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>classFilter<span class="token punctuation">,</span> other<span class="token punctuation">.</span><span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>

	<span class="token doc-comment comment">/**
	 * 求交集
	 */</span>
	<span class="token keyword">public</span> <span class="token class-name">ComposablePointcut</span> <span class="token function">intersection</span><span class="token punctuation">(</span><span class="token class-name">Pointcut</span> other<span class="token punctuation">)</span> <span class="token punctuation">{</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>classFilter <span class="token operator">=</span> <span class="token class-name">ClassFilters</span><span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>classFilter<span class="token punctuation">,</span> other<span class="token punctuation">.</span><span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">this</span><span class="token punctuation">.</span>methodMatcher <span class="token operator">=</span> <span class="token class-name">MethodMatchers</span><span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>methodMatcher<span class="token punctuation">,</span> other<span class="token punctuation">.</span><span class="token function">getMethodMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>组合Pointcut的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">PointcutApiDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">EchoServicePointcut</span> echoServicePointcut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EchoServicePointcut</span><span class="token punctuation">(</span><span class="token string">&quot;echo&quot;</span><span class="token punctuation">,</span> <span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ComposablePointcut</span> pointcut <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ComposablePointcut</span><span class="token punctuation">(</span><span class="token class-name">EchoServiceEchoMethodPointcut</span><span class="token punctuation">.</span><span class="token constant">INSTANCE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 组合实现</span>
        pointcut<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>echoServicePointcut<span class="token punctuation">.</span><span class="token function">getClassFilter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        pointcut<span class="token punctuation">.</span><span class="token function">intersection</span><span class="token punctuation">(</span>echoServicePointcut<span class="token punctuation">.</span><span class="token function">getMethodMatcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 将Pointcut适配成Advisor</span>
        <span class="token class-name">DefaultPointcutAdvisor</span> advisor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPointcutAdvisor</span><span class="token punctuation">(</span>pointcut<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">EchoServiceMethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">DefaultEchoService</span> defaultEchoService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEchoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span>defaultEchoService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加Advisor</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvisor</span><span class="token punctuation">(</span>advisor<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">)</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pointcut便利实现" tabindex="-1"><a class="header-anchor" href="#pointcut便利实现" aria-hidden="true">#</a> Pointcut便利实现</h2><p>通常而言，有三种Pointcut便利实现：</p><ul><li>静态Pointcut - StaticMethodMatcherPointcut</li><li>正则表达式Pointcut - JdkRegexpMethodPointcut</li><li>控制流Pointcut - ControlFlowPointcut</li></ul><h2 id="pointcut-aspectj实现" tabindex="-1"><a class="header-anchor" href="#pointcut-aspectj实现" aria-hidden="true">#</a> Pointcut AspectJ实现</h2><p>实现类 - org.springframework.aop.aspectj.AspectJExpressionPointcut</p><p>指令支持 - SUPPORTED_PRIMITIVES字段</p><p>表达式 - org.aspectj.weaver.tools.PointcutExpression</p><blockquote><p>Spring当中并没有定义新的AOP表达式，而是使用了AspectJ的实现。</p></blockquote><h2 id="joinpoint执行动作接口" tabindex="-1"><a class="header-anchor" href="#joinpoint执行动作接口" aria-hidden="true">#</a> Joinpoint执行动作接口</h2><p>Around Advice - Interceptor</p><ul><li>方法拦截器 - MethodInterceptor</li><li>构造器拦截器 - ControInterceptor</li></ul><p>前置动作</p><ul><li>标准接口 - org.springframework.aop.BeforeAdvice</li><li>方法级别 - org.springframework.aop.MethodBeforeAdvice</li></ul><p>后置动作</p><ul><li>org.springframework.aop.AfterAdvice</li><li>org.springframework.aop.AfterReturningAdvice</li><li>org.springframework.aop.ThrowsAdvice</li></ul><blockquote><p>Interceptor就可以认为是AroundAdvice。</p></blockquote><h2 id="before-advice标准实现" tabindex="-1"><a class="header-anchor" href="#before-advice标准实现" aria-hidden="true">#</a> Before Advice标准实现</h2><p>所谓标准实现，是指Spring在引入AspectJ之前的AOP实现。</p><ul><li>标准接口 - org.springframework.aop.BeforeAdvice</li><li>方法级别 - org.springframework.aop.MethodBeforeAdvice</li></ul><p>实现：org.springframework.aop.framework.adapter.MethodBeforeAdviceInterceptor</p><blockquote><p>用户实现的BeforeAdvice和MethodBeforeAdvice会被包装成MethodBeforeAdviceInterceptor，在Spring AOP框架内部进行执行。</p></blockquote><h2 id="before-advice-aspectj实现" tabindex="-1"><a class="header-anchor" href="#before-advice-aspectj实现" aria-hidden="true">#</a> Before Advice AspectJ实现</h2><p>实现类 - org.springframework.aop.aspectj.AspectJMethodBeforeAdvice</p><h2 id="after-advice标准实现" tabindex="-1"><a class="header-anchor" href="#after-advice标准实现" aria-hidden="true">#</a> After Advice标准实现</h2><p>相关的接口：</p><ul><li>org.springframework.aop.AfterAdvice</li><li>org.springframework.aop.AfterReturningAdvice</li><li>org.springframework.aop.ThrowsAdvice</li></ul><p>实现类：</p><ul><li>org.springframework.aop.framework.adapter.ThrowsAdviceInterceptor</li><li>org.springframework.aop.framework.adapter.AfterReturningAdviceInterceptor</li></ul><p>我们可以自己实现一个ThrowsAdvice：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MyThrowsAdvice</span> <span class="token keyword">implements</span> <span class="token class-name">ThrowsAdvice</span> <span class="token punctuation">{</span>
    <span class="token comment">// 方法名称必须为afterThrowing</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token class-name">RuntimeException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;Exception: %S/n&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">afterThrowing</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">,</span> <span class="token class-name">Exception</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;method : %s,args: %s,Exception: %S/n&quot;</span><span class="token punctuation">,</span>
                method<span class="token punctuation">,</span>
                <span class="token class-name">Arrays</span><span class="token punctuation">.</span><span class="token function">asList</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span><span class="token punctuation">,</span>
                target<span class="token punctuation">,</span>
                e<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>观察结果：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ThrowsAdviceDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">ThrowsAdviceDemo</span> instance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ThrowsAdviceDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span>instance<span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MyThrowsAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">ThrowsAdviceDemo</span> proxy <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">ThrowsAdviceDemo</span><span class="token punctuation">)</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxy<span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Random</span> random <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Random</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>random<span class="token punctuation">.</span><span class="token function">nextBoolean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;For Purpose&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Executing...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="after-advice-aspectj实现" tabindex="-1"><a class="header-anchor" href="#after-advice-aspectj实现" aria-hidden="true">#</a> After Advice AspectJ实现</h2><p>实现的接口与Spring标准实现没有什么区别：</p><ul><li>org.springframework.aop.AfterAdvice</li><li>org.springframework.aop.AfterReturningAdvice</li><li>org.springframework.aop.ThrowsAdvice</li></ul><p>实现：</p><ul><li>org.springframework.aop.aspectj.AspectJAfterAdvice</li><li>org.springframework.aop.aspectj.AspectJAfterReturningAdvice</li><li>org.springframework.aop.aspectj.AspectJAfterThrowingAdvice</li></ul><h2 id="advisor接口" tabindex="-1"><a class="header-anchor" href="#advisor接口" aria-hidden="true">#</a> Advisor接口</h2><p>Advisor是AOP概念中没有的，只在Spring当中有这个概念。</p><p>接口 - org.springframework.aop.Advisor</p><p>通用实现 - org.springframework.aop.support.DefaultPointcutAdvisor</p><blockquote><p>Advisor可以认为是Advice的容器，并且是一对一的关系，即一个Advisor持有一个Advice。实际上，在Spring内部传递Advice的时候都传递的是Advisor对象。</p></blockquote><h2 id="pointcutadvisor接口" tabindex="-1"><a class="header-anchor" href="#pointcutadvisor接口" aria-hidden="true">#</a> PointcutAdvisor接口</h2><p>接口 - org.springframework.aop.PointcutAdvisor</p><p>通用实现 ：</p><ul><li>org.springframework.aop.support.DefaultPointcutAdvisor</li></ul><p>AspectJ实现：</p><ul><li>org.springframework.aop.aspectj.AspectJExpressionPointcutAdvisor</li><li>org.springframework.aop.aspectj.AspectJPointcutAdvisor</li></ul><p>静态方法实现：</p><ul><li>org.springframework.aop.support.StaticMethodMatcherPointcutAdvisor</li></ul><p>IoC容器实现：</p><ul><li>org.springframework.aop.support.AbstractBeanFactoryPointcutAdvisor</li></ul><p>基本所有的PointcutAdvisor实现可以看成是一个容器，其中包含了Pointcut与Advice，并且具备相对顺序的特性。</p><h2 id="intorductionadvisor接口" tabindex="-1"><a class="header-anchor" href="#intorductionadvisor接口" aria-hidden="true">#</a> IntorductionAdvisor接口</h2><p>接口 - org.springframework.aop.IntroductionAdvisor</p><p>元信息：</p><ul><li>org.springframework.aop.IntroductionInfo</li></ul><p>通用实现：</p><ul><li>org.springframework.aop.support.DefaultIntroductionAdvisor</li></ul><p>AspectJ实现：</p><ul><li>org.springframework.aop.aspectj.DeclareParentsAdvisor</li></ul><p>IntroductionAdvisor只过滤类型，而不关心方法。其中IntroductionAdvisor实现了IntroductionInfo：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IntroductionInfo</span> <span class="token punctuation">{</span>

   <span class="token doc-comment comment">/**
    * Return the additional interfaces introduced by this Advisor or Advice.
    * <span class="token keyword">@return</span> the introduced interfaces
    */</span>
   <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>当一个类实现了多个接口，如果只想对其中部分接口进行代理，就可以使用IntroductionInfo来进行过滤。</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">IntroductionAdvisorDemo</span> <span class="token keyword">implements</span> <span class="token class-name">EchoService</span><span class="token punctuation">,</span> <span class="token class-name">Comparable</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">IntroductionAdvisorDemo</span> target <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">IntroductionAdvisorDemo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 使用该都构造器会使得IntroductionInfo失效</span>
        <span class="token comment">// ProxyFactory proxyFactory = new ProxyFactory(target);</span>
        <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">setTarget</span><span class="token punctuation">(</span>target<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加Advisor</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvisor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">DefaultIntroductionAdvisor</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">MethodBeforeAdvice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">before</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">,</span> <span class="token class-name">Object</span> target<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;BeforeAdvice: &quot;</span> <span class="token operator">+</span> method<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">IntroductionInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">getInterfaces</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">Class</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token class-name">EchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Map</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Object</span> proxy <span class="token operator">=</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">)</span> proxy<span class="token punctuation">;</span>
        echoService<span class="token punctuation">.</span><span class="token function">echo</span><span class="token punctuation">(</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">Map</span> map <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Map</span><span class="token punctuation">)</span>proxy<span class="token punctuation">;</span>
        map<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        
        <span class="token comment">// 如果IntroductionInfo#getInterfaces未传入Comparable,这里会无法转换</span>
        <span class="token class-name">Comparable</span> comparable <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">Comparable</span><span class="token punctuation">)</span> proxy<span class="token punctuation">;</span>
        comparable<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">int</span> <span class="token function">compareTo</span><span class="token punctuation">(</span><span class="token class-name">Object</span> o<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">echo</span><span class="token punctuation">(</span><span class="token class-name">String</span> message<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NullPointerException</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token string">&quot;IntroductionAdvisorDemo: &quot;</span> <span class="token operator">+</span> message<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="advisoradapter接口" tabindex="-1"><a class="header-anchor" href="#advisoradapter接口" aria-hidden="true">#</a> AdvisorAdapter接口</h2><p>AdvisorAdapter的作用是将Advice适配成MethodInterceptor。</p><p>接口 - org.springframework.aop.framework.adapter.AdvisorAdapter</p><p>MethodBeforeAdvice实现：</p><ul><li>org.springframework.aop.framework.adapter.MethodBeforeAdviceAdapter</li></ul><p>AfterReturningAdvice实现：</p><ul><li>org.springframework.aop.framework.adapter.AfterReturningAdviceAdapter</li></ul><p>ThrowsAdvice实现：</p><ul><li>org.springframework.aop.framework.adapter.ThrowsAdviceAdapter</li></ul><blockquote><p>除了使用默认的Advice，我们还可以使用DefaultAdvisorAdapterRegistry#registerAdvisorAdapter方法扩展自定义的Advice，于此同时，还需要实现一个Adapter。</p></blockquote><h2 id="aopproxy接口" tabindex="-1"><a class="header-anchor" href="#aopproxy接口" aria-hidden="true">#</a> AopProxy接口</h2><p>AopProxy接口的作用是一个返回配置好的AOP代理对象。</p><p>接口 - org.springframework.aop.framework.AopProxy</p><p>实现方式：</p><ul><li>JDK动态代理 <ul><li>org.springframework.aop.framework.JdkDynamicAopProxy</li></ul></li><li>CGLIB字节码提升 <ul><li>org.springframework.aop.framework.CglibAopProxy <ul><li>org.springframework.aop.framework.ObjenesisCglibAopProxy</li></ul></li></ul></li></ul><h2 id="aopproxyfactory" tabindex="-1"><a class="header-anchor" href="#aopproxyfactory" aria-hidden="true">#</a> AopProxyFactory</h2><p>AopProxyFactory是AopProxy的工厂实现。</p><p>接口 - org.springframework.aop.framework.AopProxyFactory</p><p>默认实现：org.springframework.aop.framework.DefaultAopProxyFactory</p><blockquote><p>除了DefaultAopProxyFactory还可以通过扩展AopProxyFactory增加AOP代理的方式。</p></blockquote><h2 id="jdk-aopproxy实现" tabindex="-1"><a class="header-anchor" href="#jdk-aopproxy实现" aria-hidden="true">#</a> JDK AopProxy实现</h2><p>实现 - org.springframework.aop.framework.JdkDynamicAopProxy</p><ul><li>配置 - org.springframework.aop.framework.AdvisedSupport</li><li>来源 - org.springframework.aop.framework.DefaultAopProxyFactory</li></ul><h2 id="cglib-aopproxy实现" tabindex="-1"><a class="header-anchor" href="#cglib-aopproxy实现" aria-hidden="true">#</a> CGLIB AopProxy实现</h2><p>实现 - org.springframework.aop.framework.CglibAopProxy</p><ul><li>配置 - org.springframework.aop.framework.AdvisedSupport</li><li>来源 - org.springframework.aop.framework.DefaultAopProxyFactory</li></ul><blockquote><p>无论是JDK的动态代理还是CGLIB都用到了ReflectiveMethodInvocation。</p></blockquote><h2 id="advisedsupport" tabindex="-1"><a class="header-anchor" href="#advisedsupport" aria-hidden="true">#</a> AdvisedSupport</h2><p>接口 - org.springframework.aop.framework.AdvisedSupport</p><ul><li>语义 - 代理配置</li><li>基类 - org.springframework.aop.framework.ProxyConfig</li><li>实现接口 - org.springframework.aop.framework.Advised</li><li>使用场景 - org.springframework.aop.framework.AopProxy实现</li></ul><blockquote><p>AdvisedSupport提供了诸多的能力，比如POJO的配置，添加Advisor等，之前在调用ProxyFactory的时候，实际上很多能力都是由AdvisedSupport来提供的。</p></blockquote><h2 id="advisorchainfactory接口" tabindex="-1"><a class="header-anchor" href="#advisorchainfactory接口" aria-hidden="true">#</a> AdvisorChainFactory接口</h2><p>核心API - org.springframework.aop.framework.AdvisorChainFactory</p><ul><li>默认实现 - org.springframework.aop.framework.DefaultAdvisorChainFactory</li><li>特殊实现 - org.springframework.aop.framework.InterceptorAndDynamicMethodMatcher</li></ul><h2 id="targetsource接口" tabindex="-1"><a class="header-anchor" href="#targetsource接口" aria-hidden="true">#</a> TargetSource接口</h2><p>核心API - org.springframework.aop.TargetSource</p><p>典型实现：</p><ul><li>org.springframework.aop.target.HotSwappableTargetSource</li><li>org.springframework.aop.target.AbstractPoolingTargetSource</li><li>org.springframework.aop.target.PrototypeTargetSource</li><li>org.springframework.aop.target.ThreadLocalTargetSource</li><li>org.springframework.aop.target.SingletonTargetSource</li></ul><blockquote><p>TargetSource实际上与BeanFactory有着密切的关系，在与Spring IoC容器进行整合的时候，目标对象的来源都是来自于BeanFactory。</p></blockquote><h2 id="proxycreatorsupport" tabindex="-1"><a class="header-anchor" href="#proxycreatorsupport" aria-hidden="true">#</a> ProxyCreatorSupport</h2><p>这个类用来创建代理对象。</p><p>核心API - org.springframework.aop.framework.ProxyCreatorSupport</p><ul><li>语义 - 代理对象创建基类</li><li>基类 - org.springframework.aop.framework.AdvisedSupport</li></ul><blockquote><p>对于ProxyCreatorSupport而言，它更关心AopProxyFactory对象的创建，所以会关联一个AopProxyFactory对象。</p></blockquote><h2 id="advisedsupportlistener" tabindex="-1"><a class="header-anchor" href="#advisedsupportlistener" aria-hidden="true">#</a> AdvisedSupportListener</h2><p>核心API - org.springframework.aop.framework.AdvisedSupportListener</p><ul><li>事件对象 - org.springframework.aop.framework.AdvisedSupport</li><li>事件来源 - org.springframework.aop.framework.ProxyCreatorSupport</li><li>激活事件触发 - ProxyCreatorSupport#createAopProxy</li><li>变更事件触发 - 代理接口变化时、Advisor变化时、配置复制</li></ul><p>相关的示例：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AdvisedSupportListener</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">DefaultEchoService</span> defaultEchoService <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DefaultEchoService</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 注入目标对象（被代理）</span>
        <span class="token class-name">ProxyFactory</span> proxyFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ProxyFactory</span><span class="token punctuation">(</span>defaultEchoService<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 如果对象存在接口的话，生成的代理对象还是JDK动态代理的</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">setTarget</span><span class="token punctuation">(</span><span class="token class-name">DefaultEchoService</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 添加Advice</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">EchoServiceMethodInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">AdvisedSupportListener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">activated</span><span class="token punctuation">(</span><span class="token class-name">AdvisedSupport</span> advised<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;AOP配置对象：&quot;</span> <span class="token operator">+</span> advised <span class="token operator">+</span> <span class="token string">&quot;已激活&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">adviceChanged</span><span class="token punctuation">(</span><span class="token class-name">AdvisedSupport</span> advised<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;AOP配置对象：&quot;</span> <span class="token operator">+</span> advised <span class="token operator">+</span> <span class="token string">&quot;已变化&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 获取代理对象</span>
        <span class="token comment">// 激活事件触发 createAopProxy &lt;- getProxy()</span>
        <span class="token class-name">EchoService</span> echoService <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">EchoService</span><span class="token punctuation">)</span> proxyFactory<span class="token punctuation">.</span><span class="token function">getProxy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        proxyFactory<span class="token punctuation">.</span><span class="token function">addAdvice</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Advice</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="proxyfactory" tabindex="-1"><a class="header-anchor" href="#proxyfactory" aria-hidden="true">#</a> ProxyFactory</h2><p>ProxyFactory是ProxyCreatorSupport的标准实现。</p><p>核心API - org.springframework.aop.framework.ProxyFactory</p><ul><li>基类 - org.springframework.aop.framework.ProxyCreatorSupport</li><li>特性增强，提供一些便利操作</li></ul><blockquote><p>ProxyCreatorSupport#createAopProxy方法是一个典型的模板设计模式。</p></blockquote><p>ProxyFactory与ProxyCreatorSupport有三大特性：配置、产生代理对象、有事件关联。</p><h2 id="proxyfactorybean" tabindex="-1"><a class="header-anchor" href="#proxyfactorybean" aria-hidden="true">#</a> ProxyFactoryBean</h2><p>核心API - org.springframework.aop.framework.ProxyFactoryBean</p><ul><li>基类 - org.springframework.aop.framework.ProxyCreatorSupport</li><li>特点，与Spring IoC容器整合： <ul><li>org.springframework.beans.factory.BeanClassLoaderAware</li><li>org.springframework.beans.factory.BeanFactoryAware</li></ul></li><li>特性增强： <ul><li>实现org.springframework.beans.factory.FactoryBean</li></ul></li></ul><h2 id="aspectjproxyfactory" tabindex="-1"><a class="header-anchor" href="#aspectjproxyfactory" aria-hidden="true">#</a> AspectJProxyFactory</h2><p>核心API - org.springframework.aop.aspectj.annotation.AspectJProxyFactory</p><ul><li>基类 - org.springframework.aop.framework.ProxyCreatorSupport</li><li>特点：AspectJ注解整合</li><li>相关API： <ul><li>AspectJ元数据 - org.springframework.aop.aspectj.annotation.AspectMetadata</li><li>AspectJ Advisor工厂 - org.springframework.aop.aspectj.annotation.AspectJAdvisorFactory</li></ul></li></ul><blockquote><p>AspectJ是通过反射找到Aspect Class，定位到它相关的注解上面的方法，通过注解上面的方法找到表达式，然后通过表达式筛选出对应的目标方法。</p></blockquote><h2 id="abstractautoproxycreator" tabindex="-1"><a class="header-anchor" href="#abstractautoproxycreator" aria-hidden="true">#</a> AbstractAutoProxyCreator</h2><p>前面的API都是通过手动插入的方式创建代理对象，有没有自动创建代理对象的方式呢？</p><p>API - org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator</p><ul><li>基类 - org.springframework.aop.framework.ProxyProcessorSupport</li><li>特点：与Spring Bean生命周期整合 <ul><li>org.springframework.beans.factory.config.SmartInstantiationAwareBeanPostProcessor</li></ul></li></ul><h2 id="ioc容器自动代理标准实现" tabindex="-1"><a class="header-anchor" href="#ioc容器自动代理标准实现" aria-hidden="true">#</a> IoC容器自动代理标准实现</h2><p>基类 - org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator</p><ul><li>默认实现 - DefaultAdvisorAutoProxyCreator</li><li>Bean名称匹配实现 - BeanNameAutoProxyCreator</li><li>Infrastructure Bean实现 - InfrastructureAdvisorAutoProxyCreator</li></ul><blockquote><p>InfrastructureAdvisorAutoProxyCreator是跟Bean的Role有关。</p></blockquote><h2 id="aspectjawareadvisorautoproxycreator" tabindex="-1"><a class="header-anchor" href="#aspectjawareadvisorautoproxycreator" aria-hidden="true">#</a> AspectJAwareAdvisorAutoProxyCreator</h2><p>AspectJAwareAdvisorAutoProxyCreator是IoC容器自动代理AspectJ的实现。</p><p>基类 - org.springframework.aop.framework.autoproxy.AbstractAdvisorAutoProxyCreator</p><h2 id="aopinfrastructurebean接口" tabindex="-1"><a class="header-anchor" href="#aopinfrastructurebean接口" aria-hidden="true">#</a> AopInfrastructureBean接口</h2><p>接口 - org.springframework.aop.framework.AopInfrastructureBean</p><ul><li>语义 - Spring AOP基础Bean标记接口</li><li>实现 <ul><li>org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator</li><li>org.springframework.aop.scope.ScopedProxyFactoryBean</li></ul></li><li>判断逻辑 <ul><li>AbstractAutoProxyCreator#isInfrastructureClass</li><li>ConfigurationClassUtils#checkConfigurationClassCandidate</li></ul></li></ul><blockquote><p>AopInfrastructureBean是一个标记接口，如果实现了这个接口，表示这个Bean是Spring 基础建设的类，这个类就不会被自动代理。</p></blockquote><h2 id="aopcontext" tabindex="-1"><a class="header-anchor" href="#aopcontext" aria-hidden="true">#</a> AopContext</h2><p>API - org.springframework.aop.framework.AopContext</p><ul><li>语义 - ThreadLocal的扩展，临时存储AOP对象</li></ul><blockquote><p>如果要使用AopContext，需要提前打开exposeProxy开关。</p></blockquote><h2 id="aopproxyutils" tabindex="-1"><a class="header-anchor" href="#aopproxyutils" aria-hidden="true">#</a> AopProxyUtils</h2><p>这个工具类是AOP代理的工具类。</p><p>API - org.springframework.aop.framework.AopProxyUtils</p><p>代表方法：</p><ul><li>getSingletonTarget - 从实例中获取单例对象</li><li>ultimateTargetClass - 从实例中获取最终目标类</li><li>completeProxiedInterfaces - 计算AdvisedSupport配置中所有被代理的接口</li><li>proxiedUserInterfaces - 从代理对象中获取代理接口</li></ul><h2 id="aoputils" tabindex="-1"><a class="header-anchor" href="#aoputils" aria-hidden="true">#</a> AopUtils</h2><p>API - org.springframework.aop.support.AopUtils</p><p>代表方法：</p><ul><li>isAopProxy - 判断对象是否为代理对象</li><li>isJdkDynamicProxy - 判断对象是否为JDK动态代理对象</li><li>isCglibProxy - 判断对象是否为CGLIB代理对象</li><li>getTargetClass - 从对象中获取目标类型</li><li>invokeJoinpointUsingReflection - 使用Java反射调用Joinpoint（目标方法）</li></ul><h2 id="aspectj-enable模块驱动" tabindex="-1"><a class="header-anchor" href="#aspectj-enable模块驱动" aria-hidden="true">#</a> AspectJ Enable模块驱动</h2><p>注解 - org.springframework.context.annotation.EnableAspectJAutoProxy</p><ul><li>属性方法 <ul><li>proxyTargetClass - 默认情况下是JDK动态代理，如果为true就会变成CGLIB代理</li><li>exposeProxy - 是否将代理对象暴露在AopContext中</li></ul></li><li>设计模式 - @Enable模块驱动 <ul><li>org.springframework.context.annotation.AspectJAutoProxyRegistrar</li></ul></li><li>底层实现 <ul><li>org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator</li></ul></li></ul><h2 id="aspectj-xml配置驱动实现" tabindex="-1"><a class="header-anchor" href="#aspectj-xml配置驱动实现" aria-hidden="true">#</a> AspectJ XML配置驱动实现</h2><p>XML元素 - &lt;aop:aspectj-autoproxy /&gt;</p><ul><li>属性 <ul><li>proxy-target-class - 是否已类型代理</li><li>expose-proxy - 是否将代理对象暴露在AopContext中</li></ul></li><li>设计模式 - Extensible XML Authoring</li><li>底层实现 <ul><li>org.springframework.aop.config.AspectJAutoProxyBeanDefinitionParser</li></ul></li></ul><p>XML标签元素的Schema实现：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aspectj-autoproxy<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java:org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	Enables the use of the @AspectJ style of Spring AOP.

	See org.springframework.context.annotation.EnableAspectJAutoProxy Javadoc
	for information on code-based alternatives to this XML element.
			]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>complexType</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>sequence</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>include<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>includeType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unbounded<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	Indicates that only @AspectJ beans with names matched by the (regex)
	pattern will be considered as defining aspects to use for Spring autoproxying.
						]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>element</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>sequence</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>proxy-target-class<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xsd:boolean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	Are class-based (CGLIB) proxies to be created? By default, standard
	Java interface-based proxies are created.
					]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>attribute</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>expose-proxy<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xsd:boolean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	Indicate that the proxy should be exposed by the AOP framework as a
	ThreadLocal for retrieval via the AopContext class. Off by default,
	i.e. no guarantees that AopContext access will work.
					]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>attribute</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>complexType</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>element</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="aop-config-schema-based实现" tabindex="-1"><a class="header-anchor" href="#aop-config-schema-based实现" aria-hidden="true">#</a> &lt;aop:config /&gt; Schema-based实现</h2><p>XML元素 - &lt;aop:config /&gt;</p><ul><li>属性 <ul><li>proxy-target-class - 是否已类型代理</li><li>expose-proxy - 是否将代理对象暴露在AopContext中</li></ul></li><li>嵌套元素 <ul><li>pointcut</li><li>advisor</li><li>aspect</li></ul></li><li>底层实现 <ul><li>org.springframework.aop.config.ConfigBeanDefinitionParser</li></ul></li></ul><p>Schema的定义：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>config<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	A section (compartmentalization) of AOP-specific configuration (including
	aspects, pointcuts, etc).
			]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>complexType</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>sequence</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pointcut<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pointcutType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unbounded<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	A named pointcut definition.
						]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>element</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>advisor<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>advisorType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unbounded<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span> <span class="token attr-name">source</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>java:org.springframework.aop.Advisor<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	A named advisor definition.
						]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>element</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aspect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aspectType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unbounded<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	A named aspect definition.
						]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>element</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>sequence</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>proxy-target-class<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xsd:boolean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	Are class-based (CGLIB) proxies to be created? By default, standard
	Java interface-based proxies are created.
					]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>attribute</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>expose-proxy<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xsd:boolean<span class="token punctuation">&quot;</span></span> <span class="token attr-name">default</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>false<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	Indicate that the proxy should be exposed by the AOP framework as a
	ThreadLocal for retrieval via the AopContext class. Off by default,
	i.e. no guarantees that AopContext access will work.
					]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>attribute</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>complexType</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>element</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="aop-aspect-schema-based实现" tabindex="-1"><a class="header-anchor" href="#aop-aspect-schema-based实现" aria-hidden="true">#</a> &lt;aop:aspect /&gt; Schema-based实现</h2><p>XML元素 - &lt;aop:aspect /&gt;</p><ul><li>父元素 - &lt;aop:config /&gt;</li><li>属性 <ul><li>ref - Spring Bean引用的名称</li><li>order - Aspect顺序数</li></ul></li><li>嵌套元素 <ul><li>pointcut</li><li>declare-parents</li><li>before</li><li>after</li><li>after-returning</li><li>after-throwing</li><li>around</li></ul></li></ul><p>schema定义：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aspect<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>aspectType<span class="token punctuation">&quot;</span></span> <span class="token attr-name">minOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">maxOccurs</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>unbounded<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	A named aspect definition.
			]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>element</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="pointcut-schema-based实现" tabindex="-1"><a class="header-anchor" href="#pointcut-schema-based实现" aria-hidden="true">#</a> Pointcut Schema-based实现</h2><p>XML元素 - &lt;aop:pointcut /&gt;</p><ul><li><p>父元素 - &lt;aop:aspect /&gt;或&lt;aop:config /&gt;</p></li><li><p>属性</p><ul><li>id - Pointcut ID</li><li>expression - （必须）AspectJ表达式</li></ul></li><li><p>底层实现</p><ul><li>org.aspectj.lang.annotation.Pointcut</li></ul><p>schema定义：</p></li></ul><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>complexType</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>pointcutType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>appinfo</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tool:</span>annotation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">tool:</span>exports</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.springframework.aop.Pointcut<span class="token punctuation">&quot;</span></span><span class="token punctuation">/&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">tool:</span>annotation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>appinfo</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>id<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xsd:string<span class="token punctuation">&quot;</span></span> <span class="token attr-name">use</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>required<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	The unique identifier for a pointcut.
				]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>attribute</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>expression<span class="token punctuation">&quot;</span></span> <span class="token attr-name">use</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>required<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xsd:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	The pointcut expression.

	For example : &#39;execution(* com.xyz.myapp.service.*.*(..))&#39;
				]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>attribute</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>complexType</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="around-advice-schema-based实现" tabindex="-1"><a class="header-anchor" href="#around-advice-schema-based实现" aria-hidden="true">#</a> Around Advice Schema-based实现</h2><p>XML元素 - &lt;aop:around /&gt;</p><ul><li>父元素- &lt;aop:aspect /&gt;</li><li>属性 <ul><li>pointcut - AspectJ Pointcut表达式</li><li>pointcut-ref - 引用的AspectJ Pointcut名称</li><li>method - 拦截目标方法</li><li>arg-names - 目标方法参数名称</li></ul></li></ul><p>schema定义：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>element</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>around<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>basicAdviceType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
     An around advice definition.
         ]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>element</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="before-advice-schema-based实现" tabindex="-1"><a class="header-anchor" href="#before-advice-schema-based实现" aria-hidden="true">#</a> Before Advice Schema-based实现</h2><p>XML元素 - &lt;aop:before /&gt;</p><ul><li>父元素 - &lt;aop:aspect /&gt;</li><li>属性 <ul><li>pointcut - AspectJ pointcut表达式</li><li>pointcut-ref - 引用的AspectJ Pointcut名称</li><li>method - 拦截目标方法</li><li>arg-names - 目标方法参数名称</li></ul></li></ul><h2 id="after-advice-schema-based实现" tabindex="-1"><a class="header-anchor" href="#after-advice-schema-based实现" aria-hidden="true">#</a> After Advice Schema-based实现</h2><p>XML元素 - &lt;aop:after /&gt;</p><ul><li>父元素 - &lt;aop:aspect /&gt;</li><li>属性 <ul><li>pointcut - AspectJ Pointcut表达式</li><li>pointcut-ref - 引用的AspectJ Pointcut名称</li><li>method - 拦截目标方法</li><li>arg-names - 目标方法参数名称</li></ul></li></ul><h2 id="after-returning-advice-schema-based实现" tabindex="-1"><a class="header-anchor" href="#after-returning-advice-schema-based实现" aria-hidden="true">#</a> After Returning Advice Schema-based实现</h2><p>XML元素 - &lt;aop:after-returning /&gt;</p><ul><li>父元素 - &lt;aop:aspect /&gt;</li><li>属性 <ul><li>pointcut - AspectJ Pointcut表达式</li><li>pointcut-ref - 引用的AspectJ Pointcut名称</li><li>method - 拦截目标方法</li><li>arg-names - 目标方法参数名称</li><li>returning - 方法参数名称</li></ul></li></ul><p>schema定义：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>complexType</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>afterReturningAdviceType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>complexContent</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>extension</span> <span class="token attr-name">base</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>basicAdviceType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>returning<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xsd:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	The name of the method parameter to which the return value must
	be passed.
						]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>attribute</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>extension</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>complexContent</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>complexType</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="after-throwing-advice-schema-based实现" tabindex="-1"><a class="header-anchor" href="#after-throwing-advice-schema-based实现" aria-hidden="true">#</a> After Throwing Advice Schema-based实现</h2><p>XML元素 - &lt;aop:after-throwing /&gt;</p><ul><li>父元素 - &lt;aop:aspect /&gt;</li><li>属性 <ul><li>pointcut - AspectJ Pointcut表达式</li><li>pointcut-ref - 引用的AspectJ Pointcut名称</li><li>method - 拦截目标方法</li><li>arg-names - 目标方法参数名称</li><li>throwing方法参数名称</li></ul></li></ul><p>schema定义：</p><div class="language-xml line-numbers-mode" data-ext="xml"><pre class="language-xml"><code>	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>complexType</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>afterThrowingAdviceType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>complexContent</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>extension</span> <span class="token attr-name">base</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>basicAdviceType<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>attribute</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>throwing<span class="token punctuation">&quot;</span></span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xsd:string<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
						<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span><span class="token cdata">&lt;![CDATA[
	The name of the method parameter to which the thrown exception must
	be passed.
						]]&gt;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>documentation</span><span class="token punctuation">&gt;</span></span>
					<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>annotation</span><span class="token punctuation">&gt;</span></span>
				<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>attribute</span><span class="token punctuation">&gt;</span></span>
			<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>extension</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>complexContent</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token namespace">xsd:</span>complexType</span><span class="token punctuation">&gt;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="advisor-schema-based实现" tabindex="-1"><a class="header-anchor" href="#advisor-schema-based实现" aria-hidden="true">#</a> Advisor Schema-based实现</h2><p>XML元素 - &lt;aop:advisor /&gt;</p><ul><li>父元素 - &lt;aop:config /&gt;</li><li>属性 <ul><li>advice-ref - Advice Bean引用</li><li>pointcut - AspectJ Pointcut表达式</li><li>pointcut-ref - AspectJ Pointcut Bean引用</li><li>order - Advisor顺序数</li></ul></li></ul><h2 id="introduction-schema-based实现" tabindex="-1"><a class="header-anchor" href="#introduction-schema-based实现" aria-hidden="true">#</a> Introduction Schema-based实现</h2><p>XML元素 - &lt;aop:declare-parents /&gt;</p><ul><li>父元素 - &lt;aop:aspect /&gt;</li><li>属性 <ul><li>types-matching - 是否已类型代理</li><li>implement-interface - 实现接口全类名</li><li>default-impl - 默认实现全类名</li><li>delegate-ref - 委派实现Bean引用</li></ul></li></ul><h2 id="作用域代理schema-based实现" tabindex="-1"><a class="header-anchor" href="#作用域代理schema-based实现" aria-hidden="true">#</a> 作用域代理Schema-based实现</h2><p>XML元素 - &lt;aop:scoped-proxy /&gt;</p><ul><li>属性 <ul><li>proxy-target-class - 是否已类型代理</li></ul></li></ul><h2 id="面试题-2" tabindex="-1"><a class="header-anchor" href="#面试题-2" aria-hidden="true">#</a> 面试题</h2><h3 id="spring-aop-advice-xml标签有哪些" tabindex="-1"><a class="header-anchor" href="#spring-aop-advice-xml标签有哪些" aria-hidden="true">#</a> Spring AOP Advice XML标签有哪些？</h3><ul><li>Around Advice：&lt;aop:around /&gt;</li><li>Before：&lt;aop:before /&gt;</li><li>After：&lt;aop:after/ &gt;</li><li>AfterReturning：&lt;aop:after-returning /&gt;</li><li>AfterThrowing：&lt;aop:after-throwing /&gt;</li></ul><h3 id="请解释spring-enbaleaspectjautoproxy的原理" tabindex="-1"><a class="header-anchor" href="#请解释spring-enbaleaspectjautoproxy的原理" aria-hidden="true">#</a> 请解释Spring @EnbaleAspectJAutoProxy的原理？</h3><p>通过BeandefinitionRegistrar注册相应的Bean。</p><h3 id="spring-configuration-class-cglib提升与aop类代理的关系" tabindex="-1"><a class="header-anchor" href="#spring-configuration-class-cglib提升与aop类代理的关系" aria-hidden="true">#</a> Spring Configuration Class CGLIB提升与AOP类代理的关系？</h3><p>@Configuration需要@ComponetScan才可以生效。</p><p>Spring Configuration Class CGLIB提升的原因是，方便Spring AOP的操作，无需显式的注册代理类，注入Advisor也比较容易，相当于天然的装配。</p><h1 id="spring-aop中的设计模式" tabindex="-1"><a class="header-anchor" href="#spring-aop中的设计模式" aria-hidden="true">#</a> Spring AOP中的设计模式</h1><p>总的来说，设计模式没有绝对的标准，像雨像雾又像风。</p><p>设计模式的背后是一些设计原则：</p><ul><li>单一职责原则：设计目的单一的类</li><li>开放-封闭原则：对扩展开放，对修改封闭</li><li>李氏替换原则：子类可以替换父类（不盲目重载父类的方法）</li><li>依赖倒置原则：要依赖于抽象，而不是具体实现；针对接口编程，不要针对实现编程</li><li>接口隔离原则：使用多个专门的接口比使用单一的总接口要好</li><li>组合重用原则：要尽量使用组合，而不是继承关系达到重用目的</li><li>迪米特原则（最少知道法则）：一个对象应当对其他对象有尽可能少的了解</li><li>共同封闭原则：一起修改的类，应该组合在一起（同一个包里）。如果必须修改应用程序里的代码，那么所有的修改都应该发生在同一个包内</li></ul><h2 id="创建型模式" tabindex="-1"><a class="header-anchor" href="#创建型模式" aria-hidden="true">#</a> 创建型模式</h2><p>用于创建对象的模式，为实例化新对象提供指南。</p><h3 id="抽象工厂模式" tabindex="-1"><a class="header-anchor" href="#抽象工厂模式" aria-hidden="true">#</a> 抽象工厂模式</h3><p>基本概念：抽象工厂模式（Abstract factory）提供了一组具有同一主题的单独的工厂封装起来。在正常使用中，客户端程序需要创建抽象工厂的具体实现，然后使用抽象工厂作为接口来创建这一主题的具体对象。客户端程序不需要知道（或关心）它从这些内部工厂方法中获得对象的具体类型，因为客户端程序仅使用这些对象的通用接口。抽象工厂模式将一组对象的实现细节与他们的一般使用分离开来。</p><p>Spring AOP举例实现：</p><ul><li>接口 - org.springframework.aop.framework.AopProxyFactory</li><li>实现 - org.springframework.aop.framework.DefaultAopProxyFactory</li></ul><h3 id="构建器模式" tabindex="-1"><a class="header-anchor" href="#构建器模式" aria-hidden="true">#</a> 构建器模式</h3><p>基本概念：构建器模式（Builder）又名建造模式，是一种对象构建模式。它可以将复杂对象的建造过程抽象出来（抽象类别），使这个抽象过程的不同实现方法可以构造出不同表现（属性）的对象</p><p>Spring AOP举例实现：</p><ul><li>实现 - org.springframework.aop.aspectj.annotation.BeanFactoryAspectJAdvisorsBuilder</li></ul><blockquote><p>通常而言，构建器模式有两种实现，一种是线程安全的，一种是非线程安全的，不过大多数场景下，使用的都是非线程安全的，例如StringBuilder。</p></blockquote><h3 id="工厂方法模式" tabindex="-1"><a class="header-anchor" href="#工厂方法模式" aria-hidden="true">#</a> 工厂方法模式</h3><p>基本概念：工厂方法模式（Factory method）就像其他创建型模式一样，它也是处理在不指定对象具体类型的情况下创建对象的问题。工厂方法模式的实质是“定义一个创建对象的接口，但让实现这个接口的类来决定实例化哪个类。工厂方法让类的实例化推迟到子类中进行。”</p><p>Spring AOP举例实现：</p><ul><li>实现 - org.springframework.aop.framework.ProxyFactory</li></ul><blockquote><p>工厂方法也分为两种，静态工厂和动态工厂，也就是说类的工厂方法或者对象的工厂方法。抽象工厂与工厂方法的区别在于，抽象工厂要求必须是抽象的，也就是说它必须是抽象类或者接口，但工厂可以是一个具体的类。</p></blockquote><h3 id="原型模式" tabindex="-1"><a class="header-anchor" href="#原型模式" aria-hidden="true">#</a> 原型模式</h3><p>基本概念：原型模式（Prototype）其特点在于通过<code>复制</code>一个已经存在的实例来返回新的实例，而不是新建实例。被复制的实例就是我们所称的<code>原型</code>，这个原型是可定制的。</p><p>原型模式多用于创建复杂的或者耗时的实例，因为这种情况下，复制一个已经存在的实例使程序运行更高效；或者创建值相等，只是命名不一样的同类数据。</p><p>Spring AOP举例实现：</p><ul><li>实现 - org.springframework.aop.target.PrototypeTargetSource</li></ul><h3 id="单例模式" tabindex="-1"><a class="header-anchor" href="#单例模式" aria-hidden="true">#</a> 单例模式</h3><p>基本概念：单例模式（Singleton）属于创建型模式的一种。在应用这个模式时，单例对象的类必须保证只有一个实例存在。许多时候整个系统只需要一个的全局对象，这样有利于我们协调系统整体的行为。比如在某个服务器程序中，该服务器的配置信息存放在一个文件中，这些配置数据由一个单例对象统一读取，然后服务器进程中的其他对象再通过这个单例对象或者这些配置信息。这种方式简化了在复杂环境下的配置管理。</p><p>Spring AOP举例实现：</p><ul><li>实现 - org.springframework.aop.target.SingletonTargetSource</li></ul><blockquote><p>单例模式中需要注意对象存在的范围。</p></blockquote><h2 id="结构型模式" tabindex="-1"><a class="header-anchor" href="#结构型模式" aria-hidden="true">#</a> 结构型模式</h2><p>结构型模式用于处理类和对象的组合问题。</p><h3 id="适配器模式" tabindex="-1"><a class="header-anchor" href="#适配器模式" aria-hidden="true">#</a> 适配器模式</h3><p>基本概念：适配器模式（Adapter）有时候也称包装模式或者包装（Wrapper）。将一个类转换成另外一个类，通过适配器包装的方式可以使得本来不兼容的接口变得兼容。</p><p>Spring AOP举例实现：</p><ul><li>实现 - org.springframework.aop.framework.adapter.AdvisorAdapter</li><li>适配对象 - org.aopalliance.aop.Advice</li><li>目标对象 - org.aopalliance.intercept.MethodInterceptor</li></ul><h3 id="组合模式" tabindex="-1"><a class="header-anchor" href="#组合模式" aria-hidden="true">#</a> 组合模式</h3><p>基本概念：组合模式（Composite）是把一组对象当成一个实例来进行处理，这个实例和这组对象时相同类型的。</p><p>Spring AOP举例实现：</p><ul><li>实现 - org.springframework.aop.support.ComposablePointcut</li><li>接口 - org.aspectj.lang.annotation.Pointcut</li><li>成员 - org.aspectj.lang.annotation.Pointcut</li></ul><h3 id="装饰器模式" tabindex="-1"><a class="header-anchor" href="#装饰器模式" aria-hidden="true">#</a> 装饰器模式</h3><p>基本概念：装饰器模式（Decorator）是一种动态地往一个类中添加新的行为的设计模式。就功能而言，修饰模式相比生成子类更为灵活，这样可以给某个对象而不是整个类添加一些功能。</p><p>Spring AOP举例实现：</p><ul><li>实现 - org.springframework.aop.aspectj.annotation.LazySingletonAspectInstanceFactoryDecorator</li></ul><p>JDK举例实现：</p><ul><li>实现 - java.io.BufferedInputStream</li></ul><p>装饰器模式以对客户端透明的方式扩展对象的功能，是继承关系的一个替代方案，以对客户端透明的方式动态的给一个对象附加更多的责任。换言之，客户端并不会觉得对象在装饰前和装饰后有什么不同。</p><p>装饰器模式可以在不创造更多子类的情况下，将对象的功能加以扩展，把客户端的调用委派到被装饰类，装饰器模式的关键在于这种扩展完全是透明的。</p><p>装饰器模式是不必改变原类文件和使用继承的情况下，动态的扩展一个对象的功能。它是通过创建一个包装对象，也就是装饰来包裹真实的对象。</p><p>装饰器的角色：</p><ul><li>抽象构建角色</li><li>具体构建角色</li><li>装饰角色</li><li>具体装饰角色</li></ul><h3 id="享元模式" tabindex="-1"><a class="header-anchor" href="#享元模式" aria-hidden="true">#</a> 享元模式</h3><p>基本概念：享元，即共享的单元。享元模式（Flyweight）使用对象来尽可能减少内存的使用量，便于分享更多的数据。常见的作法是对象放在数据结构外部，等需要的时候在将它们传递给享元。</p><p>Spring AOP举例实现：</p><ul><li>实现 - org.springframework.aop.framework.adapter.AdvisorAdapterRegistry</li></ul><blockquote><p>享元模式与单例模式的区别在于，享元模式不一定是单例本身，它可能只是一个代理或者门面。</p></blockquote><h3 id="代理模式-1" tabindex="-1"><a class="header-anchor" href="#代理模式-1" aria-hidden="true">#</a> 代理模式</h3><p>基本概念：代理模式（Proxy）是指一个类型可以作为其他东西的界面。代理者可以作任何东西的介面：网络连接、内存等资源。代理模式分为静态代理和动态代理。</p><p>Spring AOP举例实现：</p><ul><li>实现 - org.springframework.aop.framework.AopProxy <ul><li>JDK - org.springframework.aop.framework.JdkDynamicAopProxy</li><li>CGLIB - org.springframework.aop.framework.CglibAopProxy</li></ul></li></ul><blockquote><p>装饰器模式和代理模式的区别在于，通常装饰器模式是静态的一种（比如植入一些辅助性的代码去修饰一些行为），而代理模式既有动态的也有静态的。</p></blockquote><h2 id="行为型模式" tabindex="-1"><a class="header-anchor" href="#行为型模式" aria-hidden="true">#</a> 行为型模式</h2><p>描述对象交互的情况以及职责分配的问题。</p><h3 id="模板方法模式" tabindex="-1"><a class="header-anchor" href="#模板方法模式" aria-hidden="true">#</a> 模板方法模式</h3><p>基本概念：模板方法（Template Method）是一个定义在父类里面的方法，这个方法可能没有具体的实现，需要在子类中重写父类中这个方法，而父类已经安排好了这些抽象方法的执行顺序以及调用逻辑。</p><p>Spring AOP举例实现：</p><ul><li>模板类 - org.springframework.aop.framework.autoproxy.AbstractAutoProxyCreator</li><li>模板方法 - getAdvicesAndAdvisorsForBean(Class, String,TargetSource)</li><li>子类实现： <ul><li>org.springframework.aop.framework.autoproxy.InfrastructureAdvisorAutoProxyCreator</li><li>org.springframework.aop.aspectj.annotation.AnnotationAwareAspectJAutoProxyCreator</li></ul></li></ul><h3 id="责任链模式" tabindex="-1"><a class="header-anchor" href="#责任链模式" aria-hidden="true">#</a> 责任链模式</h3><p>基本概念：责任链模式（Chain of Responsibility）包含了一些命令对象和一系列的处理对象。每一个处理对象决定它能处理哪些命令对象，它也知道如何将它不能处理的命令对象传递给该链中的下一个对象。该模式还描述了往该处理链的末尾添加新的处理对象的方法。</p><p>Spring AOP举例实现：</p><ul><li>org.springframework.aop.framework.AdvisorChainFactory</li><li>org.springframework.aop.framework.DefaultAdvisorChainFactory</li></ul><blockquote><p>责任链模式有时候有称为Pipline。</p></blockquote><h3 id="观察者模式" tabindex="-1"><a class="header-anchor" href="#观察者模式" aria-hidden="true">#</a> 观察者模式</h3><p>基本概念：观察者模式（Observer）是指一个目标对象管理所有依赖它的观察者对象，并且在它本身的状态改变时主动发出通知。通常伴随着事件或者消息的方式来进行传递。</p><p>Spring AOP举例实现：</p><ul><li>观察者 - org.springframework.aop.framework.ProxyCreatorSupport</li><li>被观察者 - org.springframework.aop.framework.AdvisedSupportListener</li><li>通知对象 - org.springframework.aop.framework.AdvisedSupport</li></ul><h3 id="策略模式" tabindex="-1"><a class="header-anchor" href="#策略模式" aria-hidden="true">#</a> 策略模式</h3><p>基本概念：策略模式（Strategy）是指对象具有某个行为，但是在不同的场景中，该行为有不同的实现算法。</p><p>Spring AOP举例实现：</p><ul><li>org.springframework.aop.framework.DefaultAopProxyFactory#createAopProxy</li><li>org.springframework.aop.config.ConfigBeanDefinitionParser#getAdviceClass</li></ul><blockquote><p>策略模式通常被认为是面向对象多态的体现。</p></blockquote><h3 id="命令模式" tabindex="-1"><a class="header-anchor" href="#命令模式" aria-hidden="true">#</a> 命令模式</h3><p>基本概念：命令模式（Strategy）是以对象为代表实际行动，命令对象可以把方法及其参数封装起来，于是这些方法（动作）可以被：</p><ul><li>重复多次</li><li>取消</li><li>取消后又再重做</li></ul><p>Spring AOP举例实现：</p><ul><li>org.aopalliance.intercept.MethodInvocation</li><li>org.aspectj.lang.ProceedingJoinPoint</li></ul><h3 id="状态模式" tabindex="-1"><a class="header-anchor" href="#状态模式" aria-hidden="true">#</a> 状态模式</h3><p>基本概念：状态模式（State）允许对象在内部状态发生变化时更改其行为。这种模式接近于有限状态机的概念，状态模式可以解释为策略模式，它能够通过调用模式接口中定义的方法来切换策略。</p><p>Spring AOP举例实现：</p><ul><li>状态对象 - org.springframework.aop.framework.ProxyConfig</li><li>影响对象 - org.springframework.aop.framework.AopProxy <ul><li>org.springframework.aop.framework.JdkDynamicAopProxy</li><li>org.springframework.aop.framework.CglibAopProxy</li></ul></li></ul><blockquote><p>状态模式可以和策略模式相互配合。</p></blockquote><h2 id="面试题-3" tabindex="-1"><a class="header-anchor" href="#面试题-3" aria-hidden="true">#</a> 面试题</h2><h3 id="gof-23设计模式和它的归类" tabindex="-1"><a class="header-anchor" href="#gof-23设计模式和它的归类" aria-hidden="true">#</a> GOF 23设计模式和它的归类？</h3><ul><li>创建模式：抽象工厂、构建器模式、工厂方法、原型模式、单例模式</li><li>结构模式：适配器模式、桥接模式、组合模式、门面模式、轻量级模式、代理模式</li><li>行为模式：责任链模式、命令模式、解释器模式、迭代器模式、中介者模式、备忘录模式、观察者模式、策略模式、状态模式、模板方法模式、访问模式。</li></ul><h3 id="举例装饰器模式和代理模式的区别" tabindex="-1"><a class="header-anchor" href="#举例装饰器模式和代理模式的区别" aria-hidden="true">#</a> 举例装饰器模式和代理模式的区别？</h3><p>代理模式不要求和被代理对象存在层次关系，装饰器模式则需要和被装饰者存在层次关系。装饰器模式通常会扩展一些行为，这些行为并不隶属于被装饰者之间，而代理模式的功能通常时被代理者的子集或者全集，不会超集。</p><p>装饰器模式：BufferedInputStream和InputStream；代理模式：Proxy</p><h3 id="请举例说明spring-framework中使用设计模式的实现" tabindex="-1"><a class="header-anchor" href="#请举例说明spring-framework中使用设计模式的实现" aria-hidden="true">#</a> 请举例说明Spring Framework中使用设计模式的实现？</h3><p>ApplicationContext就是一种门面模式的实现......</p><h1 id="spring-aop内部应用" tabindex="-1"><a class="header-anchor" href="#spring-aop内部应用" aria-hidden="true">#</a> Spring AOP内部应用</h1><p>Spring AOP在Spring Framework中的应用的实现都大同小异，大致都分为以下三个步骤：</p><ol><li>Enable模块驱动</li><li>注册Proxy的Configuration Class</li><li>实现PointcurAdvisor和MethodInterceptor</li></ol><h2 id="spring-事件中的应用" tabindex="-1"><a class="header-anchor" href="#spring-事件中的应用" aria-hidden="true">#</a> Spring 事件中的应用</h2><p>核心API - org.springframework.context.event.EventPublicationInterceptor</p><p>特殊描述：当Spring AOP代理Bean中的JoinPoint方法执行后，Spring ApplicationContext将发布一个自定义事件（ApplicationEvent子类）</p><p>使用限制：</p><ul><li>EventPublicationInterceptor关联的ApplicationEvent子类必须存在单参数的构造器，参数类型必须是Object</li><li>EventPublicationInterceptor需要被声明为Spring Bean</li></ul><p>其中第一点是因为：</p><p><img src="https://blog-1304855543.cos.ap-guangzhou.myqcloud.com/blog/img/20210723140848.png" alt="image-20210723140848060"></p><p>需要被声明为Spring Bean的原因是：</p><p><img src="https://blog-1304855543.cos.ap-guangzhou.myqcloud.com/blog/img/20210723140929.png" alt="image-20210723140929830"></p><p>接下来我们通过实例的方式演示EventPublicationInterceptor这个API的使用，首先定义好事件：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ExecutedEvent</span> <span class="token keyword">extends</span> <span class="token class-name">ApplicationEvent</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token class-name">ExecutedEvent</span><span class="token punctuation">(</span><span class="token class-name">Object</span> source<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>source<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>为了参照对比，这里使用传统的事务发送方式和AOP拦截的方式两种：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticExecutor</span> <span class="token keyword">implements</span> <span class="token class-name">ApplicationEventPublisherAware</span> <span class="token punctuation">{</span>

    <span class="token keyword">private</span> <span class="token class-name">ApplicationEventPublisher</span> applicationEventPublisher<span class="token punctuation">;</span>

    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;StaticExecutor Executing...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        applicationEventPublisher<span class="token punctuation">.</span><span class="token function">publishEvent</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ExecutedEvent</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">setApplicationEventPublisher</span><span class="token punctuation">(</span><span class="token class-name">ApplicationEventPublisher</span> applicationEventPublisher<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>applicationEventPublisher <span class="token operator">=</span> applicationEventPublisher<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用AOP方式的执行器：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Executor</span> <span class="token punctuation">{</span> <span class="token comment">// ClassFilter</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">execute</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">// MethodMatcher：Join Point方法（需要Pointcut来匹配）</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Executor Executing...&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>最终的效果：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token annotation punctuation">@Configuration</span> <span class="token comment">// Configuration Class</span>
<span class="token annotation punctuation">@EnableAspectJAutoProxy</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">EventPublicationInterceptorDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">AnnotationConfigApplicationContext</span> context <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AnnotationConfigApplicationContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">register</span><span class="token punctuation">(</span><span class="token class-name">EventPublicationInterceptorDemo</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">Executor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> <span class="token class-name">StaticExecutor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        context<span class="token punctuation">.</span><span class="token function">refresh</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 5.执行目标方法</span>
        <span class="token class-name">Executor</span> executor <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">Executor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">StaticExecutor</span> staticExecutor <span class="token operator">=</span> context<span class="token punctuation">.</span><span class="token function">getBean</span><span class="token punctuation">(</span><span class="token class-name">StaticExecutor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        System.out.println(executor);</span>
<span class="token comment">//        System.out.println(staticExecutor);</span>
        context<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 1.将EventPublicationInterceptor声明为Spring Bean</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">EventPublicationInterceptor</span> <span class="token function">eventPublicationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">EventPublicationInterceptor</span> eventPublicationInterceptor <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">EventPublicationInterceptor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 关联目标（自定义）事件类型</span>
        eventPublicationInterceptor<span class="token punctuation">.</span><span class="token function">setApplicationEventClass</span><span class="token punctuation">(</span><span class="token class-name">ExecutedEvent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> eventPublicationInterceptor<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 2.实现 Pointcut(这一步可以没有)</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">Pointcut</span> <span class="token function">pointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">StaticMethodMatcherPointcut</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">boolean</span> <span class="token function">matches</span><span class="token punctuation">(</span><span class="token class-name">Method</span> method<span class="token punctuation">,</span> <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> targetClass<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token string">&quot;execute&quot;</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>method<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token class-name">Executor</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>targetClass<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 3.声明一个Advisor Bean</span>
    <span class="token annotation punctuation">@Bean</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token class-name">PointcutAdvisor</span> <span class="token function">pointcutAdvisor</span><span class="token punctuation">(</span><span class="token class-name">Pointcut</span> pointcut<span class="token punctuation">,</span> <span class="token class-name">EventPublicationInterceptor</span> eventPublicationInterceptor<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// EventPublicationInterceptor is MethodInterceptor is Advice</span>
        <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">DefaultPointcutAdvisor</span><span class="token punctuation">(</span>pointcut<span class="token punctuation">,</span> eventPublicationInterceptor<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 4.处理事件</span>
    <span class="token annotation punctuation">@EventListener</span><span class="token punctuation">(</span><span class="token class-name">ExecutedEvent</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">executed</span><span class="token punctuation">(</span><span class="token class-name">ExecutedEvent</span> event<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;Executed: &quot;</span> <span class="token operator">+</span> event<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="spring事务中的应用" tabindex="-1"><a class="header-anchor" href="#spring事务中的应用" aria-hidden="true">#</a> Spring事务中的应用</h2><h3 id="核心api" tabindex="-1"><a class="header-anchor" href="#核心api" aria-hidden="true">#</a> 核心API</h3><ul><li>Spring事务@Enanle模块驱动 - @EnableTranSactionManagement</li><li>Spring事务注解 - @Transactional</li><li>Spring事务事件监听器 - @TransactionalEventListener</li><li>Spring事务定义 - TransactionDefinition</li><li>Spring事务状态 - TransactionStatus</li><li>Spring平台事务管理 - PlatformTransactionManager</li><li>Spring事务代理配置 - ProxyTransactionManagementConfiguration</li><li>Spring事务PointcutAdvisor实现 - BeanFactoryTransactionAttrubuteSourceAdvisor</li><li>Spring事务MethodInterceptor实现 - TransactionInterceptor</li><li>Spring事务属性源 - TransactionAttributeSource</li></ul><h3 id="理解transactiondefinition" tabindex="-1"><a class="header-anchor" href="#理解transactiondefinition" aria-hidden="true">#</a> 理解TransactionDefinition</h3><p>说明：Spring事务定义</p><p>核心方法：</p><ul><li>getIsolationLevel()：获取隔离级别，默认值ISOLATION_DEFAULT常量，参考org.springframework.transaction.annotation.Isolation</li><li>getPropagationBehavior()：获取事务传播，默认值：PROPAGATION_REQUIRED常量，参考org.springframework.transaction.annotation.Propagation</li><li>getTimeout()：获取事务执行超时事件，默认值：TIMEOUT_DEFAULT常量</li><li>isReadOnly：是否为只读事务，默认值：false</li></ul><h3 id="理解platformtransactionmanager" tabindex="-1"><a class="header-anchor" href="#理解platformtransactionmanager" aria-hidden="true">#</a> 理解PlatformTransactionManager</h3><p>说明：平台事务管理器</p><p>核心方法：</p><ul><li>getTransaction(TransactionDefinition)：获取事务状态（逻辑事务）</li><li>commit(TransactionStatus)：提交事务</li><li>rollback(TransactionStatus)：回滚事务</li></ul><h3 id="理解事务传播" tabindex="-1"><a class="header-anchor" href="#理解事务传播" aria-hidden="true">#</a> 理解事务传播</h3><p>官网链接：<a href="https://docs.spring.io/spring-framework/docs/current/reference/html/data-access.html#tx-propagation" target="_blank" rel="noopener noreferrer">Spring事务传播<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><h2 id="spring-缓存中的应用" tabindex="-1"><a class="header-anchor" href="#spring-缓存中的应用" aria-hidden="true">#</a> Spring 缓存中的应用</h2><p>核心API：</p><ul><li>Spring缓存@Enable模块驱动 - @EnableCaching</li><li>缓存操作注解 - @Caching、@Cachable、@CachePut、@CacheEvict</li><li>缓存配置注解 - @CacheConfig</li><li>缓存注解操作数据源 - AnnotationCacheOperationSource</li><li>Spring缓存注解解析器 - SpringCacheAnnotationParser</li><li>Spring缓存管理器 - CacheManager</li><li>Spring缓存接口 - Cache</li><li>Spring缓存代理配置 - ProxyCachingConfiguration</li><li>Spring缓存PointcutAdvisor实现 - BeanFactoryCacheOperationSourceAdvisor</li><li>Spring缓存MethodInterceptor实现 - CacheInterceptor</li></ul><h2 id="spring本地调度中的应用" tabindex="-1"><a class="header-anchor" href="#spring本地调度中的应用" aria-hidden="true">#</a> Spring本地调度中的应用</h2><p>核心API：</p><ul><li>Spring异步@Enable模块驱动 - @EnableAsync</li><li>Spring异步注解 - @Async</li><li>Spring异步配置器 - AsyncConfigurer</li><li>Spring异步代理配置 - ProxyAsyncConfiguration</li><li>Spring异步PointcurAdvisor实现 - AsyncAnnotationAdvisor</li><li>Spring异步MethodInterceptor实现 - AnnotationAsyncExecutionInterceptor</li></ul><h2 id="面试题-4" tabindex="-1"><a class="header-anchor" href="#面试题-4" aria-hidden="true">#</a> 面试题</h2><h3 id="spring-aop在spring-framework特性运用" tabindex="-1"><a class="header-anchor" href="#spring-aop在spring-framework特性运用" aria-hidden="true">#</a> Spring AOP在Spring Framework特性运用？</h3><ul><li>Spring 事件（Events）</li><li>Spring 事务（Transaction）</li><li>Spring 缓存（Caching）</li><li>Spring 本地调度（Scheduling）</li><li>Spring远程（Remoting）</li></ul><h3 id="spring事务传播的原理" tabindex="-1"><a class="header-anchor" href="#spring事务传播的原理" aria-hidden="true">#</a> Spring事务传播的原理？</h3><p>这里最主要的是要掌握逻辑事务和物理事务的区别。</p><h3 id="spring-aop与ioc功能整合的设计模式" tabindex="-1"><a class="header-anchor" href="#spring-aop与ioc功能整合的设计模式" aria-hidden="true">#</a> Spring AOP与IoC功能整合的设计模式？</h3><ul><li>实现Advice或MethodInterceptor</li><li>实现PointcutAdvisor</li><li>实现Spring AOP代理配置类</li><li>（可选）实现注解和注解元信息的解析以及处理</li><li>（可选）实现XML与其元信息的解析以及处理</li></ul><p>Spring AOP与Ioc功能整合。</p></div><!--[--><!--]--></div><footer class="page-meta"><div class="meta-item edit-link"><a class="external-link meta-item-label" href="https://github.com/jycoast/edit/main/framework/spring_aop/README.md" rel="noopener noreferrer" target="_blank" aria-label="Edit this page"><!--[--><!--]--> Edit this page <span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!--[--><!--]--></a></div><div class="meta-item last-updated"><span class="meta-item-label">Last Updated: </span><!----></div><div class="meta-item contributors"><span class="meta-item-label">Contributors: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: jycoder@163.com">jiyongchao</span><!----><!--]--><!--]--></span></div></footer><!----><!--[--><!--]--></main><!--]--></div><!----><!--]--></div>
    <script type="module" src="/assets/app-54c7c23e.js" defer></script>
  </body>
</html>
